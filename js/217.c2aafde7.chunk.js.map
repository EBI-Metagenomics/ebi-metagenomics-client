{"version":3,"file":"js/217.c2aafde7.chunk.js","mappings":"uQAcA,IAAc,GAEd,MA4FA,EA5F+D,EAC7DA,kBAAAA,GAAoB,MAEpB,MAAMC,GAAoB,IAAAC,QAAkC,MACtDC,GAAY,UACZ,QAAEC,EAAO,QAAEC,IAAY,UACvB,KAAEC,EAAI,QAAEC,EAAO,MAAEC,IAAU,OAAc,WAAWL,SAAkB,CAC1EM,UAAW,MAGb,GAAIF,EAAS,OAAO,gBAAC,IAAO,CAACG,KAAK,UAClC,GAAIF,EAAO,OAAO,gBAAC,IAAU,CAACA,MAAOA,IACrC,IAAKF,EAAM,OAAO,gBAAC,IAAO,MAC1B,IAAIK,EAAQ,EACZ,MAAMC,EAAcN,EAAKA,KAAuBO,KAAKC,GACnDC,OAAOD,EAAEE,WAAWC,QAEhBC,EAA0BZ,EAAKA,KAAuBa,QAC1D,CAACC,EAAMN,KAELM,EAAKN,EAAEE,WAAWC,MAAkBH,EAAEE,WAAWK,YAC1CD,IAET,IAEIE,EAAgBhB,EAAKA,KAAuBO,KAAKC,IACrD,MAAMS,EAAIC,OAAOV,EAAEE,WAAW,iBAE9B,OADAL,GAASY,EACFA,KAEHE,EAAmBnB,EAAKA,KAAuBO,KAAKC,GACjDA,EAAEE,WAAW,qBA2CtB,OAzCAX,EAAQqB,MAAQ,CACdC,KAAM,yBAERtB,EAAQuB,SAAW,CACjBD,KAAM,UAAUhB,8CAElBN,EAAQwB,MAAQ,CACdjB,WAAAA,GAEFP,EAAQyB,QAAU,CAEhBC,YACE,MAAMV,EAAcH,EAAuBc,KAAKC,KAChD,IAAIH,EAAU,GAAGE,KAAKE,OAAOjB,mBAAmBe,KAAKG,IAIrD,OAHId,IACFS,GAAW,cAAcT,KAEpBS,IAIXzB,EAAQ6B,OAAS,CACf,CACEjB,KAAM,SACNmB,KAAM,SACN9B,KAAMgB,EAAae,MAAM,EAAG,IAC5BC,OAAQ,KACRC,MAAO,WAIPvC,GACFK,EAAQ6B,OAAOM,KAAK,CAClBvB,KAAM,aACNmB,KAAM,SACN9B,KAAMmB,EAAgBY,MAAM,EAAG,IAC/BC,OAAQ,KACRC,MAAO,cAKT,uBAAKE,UAAU,0BACb,gBAAC,IAAe,CACdC,WAAY,EACZrC,QAASA,EACTsC,IAAK1C,IAEP,gBAAC,IAAQ,CACP2C,KAAMxC,EACNE,KAAMA,EACNoB,MAAO,OAAOpB,EAAKuC,KAAKC,WAAWC,uBACnCxC,QAASA,EACTyC,gBAAgB,O,wDCzFxB,MAiFA,EAjF+B,KA8EtB,CAAE5C,SA7EO,IAAA6C,UACd,IAAM,CACJ,CACEC,OAAQ,SACRC,SAAU,mBAEZ,CACED,OAAQ,cACRC,SAAU,0BAEZ,CACED,OAAQ,eACRC,SAAU,2BAEZ,CACED,OAAQ,mBACRC,SAAU,gCAGd,IA0DgB9C,QAvDkB,CAClC+C,MAAO,CACLhB,KAAM,SACNiB,OAAQ,IACRC,SAAU,KACVC,SAAU,aAKZC,MAAO,CACLC,IAAK,EACL/B,MAAO,CACLC,KAAM,sBAMV+B,YAAa,CACXxB,OAAQ,CACNyB,SAAU,UAEZC,OAAQ,CACNC,kBAAkB,EAClBC,OAAQ,UACRxB,OAAQ,OAGZyB,QAAS,CACPC,SAAS,GAEXC,OAAQ,CACND,SAAS","sources":["webpack://mgportalv2/./src/components/Genomes/COGAnalysis/index.tsx","webpack://mgportalv2/./src/hooks/genomes/useDefaultConfig/index.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport * as Highcharts from 'highcharts';\nimport addExportMenu from 'highcharts/modules/exporting';\nimport HighchartsReact from 'highcharts-react-official';\n\nimport Loading from 'components/UI/Loading';\nimport FetchError from 'components/UI/FetchError';\nimport EMGTable from 'components/UI/EMGTable';\nimport useMGnifyData from 'hooks/data/useMGnifyData';\nimport { MGnifyDatum, MGnifyResponseList } from 'hooks/data/useData';\nimport useURLAccession from 'hooks/useURLAccession';\nimport useDefaultGenomeConfig from 'hooks/genomes/useDefaultConfig';\nimport { TAXONOMY_COLOURS } from 'utils/taxon';\n\naddExportMenu(Highcharts);\n\nconst COGAnalises: React.FC<{ includePangenomes?: boolean }> = ({\n  includePangenomes = true,\n}) => {\n  const chartComponentRef = useRef<HighchartsReact.RefObject>(null);\n  const accession = useURLAccession();\n  const { columns, options } = useDefaultGenomeConfig();\n  const { data, loading, error } = useMGnifyData(`genomes/${accession}/cogs`, {\n    page_size: 100,\n  });\n\n  if (loading) return <Loading size=\"large\" />;\n  if (error) return <FetchError error={error} />;\n  if (!data) return <Loading />;\n  let total = 0;\n  const categories = (data.data as MGnifyDatum[]).map((d) =>\n    String(d.attributes.name)\n  );\n  const categoriesDescriptions = (data.data as MGnifyDatum[]).reduce(\n    (memo, d) => {\n      // eslint-disable-next-line no-param-reassign\n      memo[d.attributes.name as string] = d.attributes.description;\n      return memo;\n    },\n    {}\n  );\n  const genomeSeries = (data.data as MGnifyDatum[]).map((d) => {\n    const c = Number(d.attributes['genome-count']);\n    total += c;\n    return c;\n  });\n  const pangenomeSeries = (data.data as MGnifyDatum[]).map((d) => {\n    return d.attributes['pangenome-count'];\n  });\n  options.title = {\n    text: 'Top 10 COG categories',\n  };\n  options.subtitle = {\n    text: `Total: ${total} Genome COG matches - Drag to zoom in/out`,\n  };\n  options.xAxis = {\n    categories,\n  };\n  options.tooltip = {\n    /* eslint-disable react/no-this-in-sfc */\n    formatter() {\n      const description = categoriesDescriptions[this.key];\n      let tooltip = `${this.series.name}<br/>Count: ${this.y}`;\n      if (description) {\n        tooltip += `<br />COG: ${description}`;\n      }\n      return tooltip;\n    },\n    /* eslint-enable react/no-this-in-sfc */\n  };\n  options.series = [\n    {\n      name: 'Genome',\n      type: 'column',\n      data: genomeSeries.slice(0, 10),\n      colors: TAXONOMY_COLOURS,\n      stack: 'genome',\n    },\n  ];\n\n  if (includePangenomes) {\n    options.series.push({\n      name: 'Pan-genome',\n      type: 'column',\n      data: pangenomeSeries.slice(0, 10),\n      colors: TAXONOMY_COLOURS,\n      stack: 'pangenome',\n    });\n  }\n\n  return (\n    <div className=\"vf-stack vf-stack--200\">\n      <HighchartsReact\n        highcharts={Highcharts}\n        options={options}\n        ref={chartComponentRef}\n      />\n      <EMGTable\n        cols={columns}\n        data={data as MGnifyResponseList}\n        title={`All ${data.meta.pagination.count} COG categories`}\n        loading={loading}\n        showPagination={false}\n      />\n    </div>\n  );\n};\n\nexport default COGAnalises;\n","import { useMemo } from 'react';\nimport * as Highcharts from 'highcharts';\n\nimport { TAXONOMY_COLOURS } from 'utils/taxon';\n\ntype DefaultConfigType = {\n  columns: {\n    Header: string;\n    accessor: string;\n  }[];\n  options: Highcharts.Options;\n};\n\nconst useGenomeDefaultConfig = (): DefaultConfigType => {\n  const columns = useMemo(\n    () => [\n      {\n        Header: 'COG ID',\n        accessor: 'attributes.name',\n      },\n      {\n        Header: 'Description',\n        accessor: 'attributes.description',\n      },\n      {\n        Header: 'Genome Count',\n        accessor: 'attributes.genome-count',\n      },\n      {\n        Header: 'Pan-genome count',\n        accessor: 'attributes.pangenome-count',\n      },\n    ],\n    []\n  );\n\n  const options: Highcharts.Options = {\n    chart: {\n      type: 'column',\n      height: 400,\n      zoomType: 'xy',\n      renderTo: 'container',\n    },\n    // subtitle: {\n    //   text: `Total: ${total} Genome COG matches - Drag to zoom in/out`,\n    // },\n    yAxis: {\n      min: 0,\n      title: {\n        text: 'Number of matches',\n      },\n    },\n    // xAxis: {\n    //   categories,\n    // },\n    plotOptions: {\n      series: {\n        stacking: 'normal',\n      },\n      column: {\n        allowPointSelect: true,\n        cursor: 'pointer',\n        colors: TAXONOMY_COLOURS,\n      },\n    },\n    credits: {\n      enabled: false,\n    },\n    legend: {\n      enabled: true,\n    },\n    // tooltip: {\n    //   formatter() {\n    //     const description = categoriesDescriptions[this.key];\n    //     let tooltip = this.series.name + '<br/>Count: ' + this.y;\n    //     if (description) {\n    //       tooltip += '<br />COG: ' + description;\n    //     }\n    //     return tooltip;\n    //   },\n    // },\n    // series: [\n    //   {\n    //     name: 'Genome',\n    //     type: 'column',\n    //     data: genomeSeries.slice(0, 10),\n    //     colors: TAXONOMY_COLOURS,\n    //     stack: 'genome',\n    //   },\n    // ],\n  };\n  return { columns, options };\n};\n\nexport default useGenomeDefaultConfig;\n"],"names":["includePangenomes","chartComponentRef","useRef","accession","columns","options","data","loading","error","page_size","size","total","categories","map","d","String","attributes","name","categoriesDescriptions","reduce","memo","description","genomeSeries","c","Number","pangenomeSeries","title","text","subtitle","xAxis","tooltip","formatter","this","key","series","y","type","slice","colors","stack","push","className","highcharts","ref","cols","meta","pagination","count","showPagination","useMemo","Header","accessor","chart","height","zoomType","renderTo","yAxis","min","plotOptions","stacking","column","allowPointSelect","cursor","credits","enabled","legend"],"sourceRoot":""}