"use strict";(self.webpackChunkmgportalv2=self.webpackChunkmgportalv2||[]).push([[597],{2379:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),r=a(2531);const l={biosynthetic:"Core biosynthetic gene","biosynthetic-additional":"Additional biosynthetic gene",regulatory:"Regulatory genes",transport:"Transport-related gene",resistance:"Resistance genes"},s=({value:e,url:t,decodeValue:a})=>{if(!e)return null;const l=e.split(",");return n.createElement("ul",{className:"vf-list"},l.map((e=>{const l=a?decodeURIComponent(e):e;return n.createElement("li",{key:e,className:"igv-popup-multiple-field-item"},t?n.createElement(r.Z,{href:`${t}${e}`},l):l)})))},o=e=>{const t="string"==typeof e.start?parseInt(e.start,10):e.start,a="string"==typeof e.end?parseInt(e.end,10):e.end;if(!Number.isNaN(t)&&!Number.isNaN(a)&&null!==t&&null!==a)return Math.ceil((a-t)/3)},i=({data:e})=>{const{name:t,gene:a,product:i,properties:c}=(e=>{const t=e.reduce(((e,t)=>(t.name&&(e[t.name.toLowerCase()]=t.value),e)),{}),a={title:"Functional annotation",data:[{name:"E.C Number",Value:t.ecnumber&&(()=>n.createElement(s,{value:t.ecnumber,url:"https://enzyme.expasy.org/EC/"}))},{name:"Pfam",Value:t.pfam&&(()=>n.createElement(s,{value:t.pfam,url:"https://pfam.xfam.org/family/"}))},{name:"KEGG",Value:t.kegg&&(()=>n.createElement(s,{value:t.kegg,url:"https://www.genome.jp/dbget-bin/www_bget?"}))},{name:"eggNOG",Value:t.eggnog&&decodeURIComponent(t.eggnog)},{name:"COG",Value:t.cog&&(()=>n.createElement(s,{value:t.cog}))},{name:"GO",Value:t.go&&(()=>n.createElement(s,{value:t.go,url:"https://www.ebi.ac.uk/ols/search?q="}))},{name:"InterPro",Value:t.interpro&&(()=>n.createElement(s,{value:t.interpro,url:"https://www.ebi.ac.uk/interpro/entry/InterPro/'"}))},{name:"Gene type",Value:t.as_type&&(l[t.as_type]||t.as_type)},{name:"Notes",Value:t.as_notes&&(()=>n.createElement(s,{value:decodeURIComponent(t.as_notes)}))},{name:"Cluster",Value:t.as_gene_clusters&&(()=>n.createElement(s,{value:t.as_gene_clusters}))}]},i={title:"Feature details",data:[{name:"Type",Value:t.type},{name:"Inference",Value:t.inference},{name:"Start / End",Value:`${t.start}/${t.end}`},{name:"Protein length",Value:String(o(t))}]},c={title:"Metaproteomics",data:[{name:"Peptide sequences",Value:t.peptide_sequences&&(()=>n.createElement(s,{value:t.peptide_sequences,decodeValue:!0}))},{name:"Pride ID",Value:t.pride_id&&(()=>n.createElement(r.Z,{href:`https://www.ebi.ac.uk/pride/archive/projects/${t.pride_id}`},t.pride_id))}]};return{name:t.id,gene:t.gene,product:t.product,properties:[a,i,c]}})(e);return n.createElement(n.Fragment,null,n.createElement("table",{className:"stack hover igv-popover-table"},n.createElement("caption",{className:"igv-popover-section-header"},"Feature"),n.createElement("tbody",null,t&&n.createElement("tr",null,n.createElement("td",{className:"igv-popover-table-td-name"},"ID"),n.createElement("td",null,t)),a&&n.createElement("tr",null,n.createElement("td",{className:"igv-popover-table-td-name"},"Gene"),n.createElement("td",null,n.createElement("em",null,a))),i&&n.createElement("tr",null,n.createElement("td",{className:"igv-popover-table-td-name"},"Product"),n.createElement("td",null,i)))),c.map((e=>n.createElement("table",{className:"stack hover igv-popover-table",key:e.title},e.data.filter((e=>!!e.Value)).length>0&&n.createElement("caption",{className:"igv-popover-section-header"},e.title),n.createElement("tbody",null,e.data.map((({name:e,Value:t})=>t&&n.createElement("tr",{key:e},n.createElement("td",{className:"igv-popover-table-td-name"},e),n.createElement("td",null,"string"==typeof t?t:n.createElement(t,null))))).filter(Boolean))))))}},2069:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294);const r=()=>n.createElement("svg",{"aria-hidden":"true",className:"vf-card__heading__icon | vf-icon vf-icon-arrow--inline-end",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",preserveAspectRatio:"none"},n.createElement("path",{d:"M0 12c0 6.627 5.373 12 12 12s12-5.373 12-12S18.627 0 12 0C5.376.008.008 5.376 0 12zm13.707-5.209l4.5 4.5a1 1 0 010 1.414l-4.5 4.5a1 1 0 01-1.414-1.414l2.366-2.367a.25.25 0 00-.177-.424H6a1 1 0 010-2h8.482a.25.25 0 00.177-.427l-2.366-2.368a1 1 0 011.414-1.414z",fill:"currentColor",fillRule:"nonzero"}))},2750:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294);const r=({onChange:e,accept:t})=>{const a=(0,n.useRef)(null);return n.createElement(n.Fragment,null,n.createElement("input",{type:"file",hidden:!0,ref:a,onChange:e,accept:t}),n.createElement("button",{className:"vf-button vf-button--primary vf-button--sm",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.click()},type:"button"},"Browse for file..."))}},3415:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294);const r=({list:e})=>n.createElement("div",{className:"vf-grid vf-grid__col-2",style:{gridTemplateColumns:"1fr 2fr",rowGap:"0.5rem"}},e.map((({key:e,value:t})=>n.createElement(n.Fragment,{key:e},n.createElement("div",{style:{textAlign:"right"}},e,":"),n.createElement("div",null,"string"==typeof t?t:n.createElement(t,null))))))},7565:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(7294),r=a(7275);a(3751);const l=({content:e,children:t})=>n.createElement(r.ZP,{content:e},t)},8502:(e,t,a)=>{a.r(t),a.d(t,{default:()=>be});var n=a(7294),r=a(8110),l=a(964),s=a(402),o=a(1699),i=a(4821),c=a(3415),m=a(9711);const u=({data:e})=>{var t,a,r,l,s,o,i,u,d,g,p,b,v,f;return n.createElement("section",null,n.createElement("div",{className:"vf-stack"},n.createElement("details",{open:!0},n.createElement("summary",null,n.createElement("b",null,"Description")),n.createElement(c.Z,{list:[{key:"Study",value:(null===(r=null===(a=null===(t=e.relationships)||void 0===t?void 0:t.study)||void 0===a?void 0:a.data)||void 0===r?void 0:r.id)&&(()=>n.createElement(m.rU,{to:`/studies/${e.relationships.study.data.id}`},e.relationships.study.data.id))},{key:"Sample",value:(null===(o=null===(s=null===(l=e.relationships)||void 0===l?void 0:l.sample)||void 0===s?void 0:s.data)||void 0===o?void 0:o.id)&&(()=>n.createElement(m.rU,{to:`/samples/${e.relationships.sample.data.id}`},e.relationships.sample.data.id))},{key:"Assembly",value:(null===(d=null===(u=null===(i=e.relationships)||void 0===i?void 0:i.assembly)||void 0===u?void 0:u.data)||void 0===d?void 0:d.id)&&(f=e.attributes["experiment-type"],["assembly","hybrid_assembly","long_reads_assembly"].includes(f))&&(()=>n.createElement(m.rU,{to:`/assemblies/${e.relationships.assembly.data.id}`},e.relationships.assembly.data.id))},{key:"Run",value:(null===(b=null===(p=null===(g=e.relationships)||void 0===g?void 0:g.run)||void 0===p?void 0:p.data)||void 0===b?void 0:b.id)&&(()=>n.createElement(m.rU,{to:`/runs/${e.relationships.run.data.id}`},e.relationships.run.data.id))},{key:"Pipeline version",value:(null===(v=e.attributes)||void 0===v?void 0:v["pipeline-version"])&&(()=>n.createElement(m.rU,{to:`/pipelines/${e.attributes["pipeline-version"]}`},e.attributes["pipeline-version"]))}].filter((({value:e})=>!!e))})),n.createElement("details",{open:!0},n.createElement("summary",null,n.createElement("b",null,"Experiment details")),n.createElement(c.Z,{list:[{key:"Experiment type",value:e.attributes["experiment-type"]},{key:"Instrument model",value:e.attributes["instrument-model"]},{key:"Instrument platform",value:e.attributes["instrument-platform"]}].filter((({value:e})=>!!e))}))))};var d=a(7838),g=a(8840),p=a(5708),b=a.n(p);const v=({analysisData:e,summaryData:t})=>{var a;const r=(0,n.useRef)(null),l="assembly"===e.attributes["experiment-type"],s=l?"contigs":"reads",o=l?"Contigs":"Reads",i=[0,0,0,0,0],c=[0,0,0,0,0],m=[0,0,0,0,0],u={};((null===(a=e.attributes)||void 0===a?void 0:a["analysis-summary"])||[]).forEach((({key:e,value:t})=>{u[e]=t})),m[4]=Number(t.sequence_count),i[0]=Number(u["Submitted nucleotide sequences"]),i[1]=Number(u["Nucleotide sequences after format-specific filtering"]),i[2]=Number(u["Nucleotide sequences after length filtering"]),i[3]=Number(u["Nucleotide sequences after undetermined bases filtering"]),c[2]=i[1]-i[2],c[1]=i[0]-i[1],c[4]=i[3]-i[4]-m[4];const d={chart:{type:"bar",height:240},title:{text:`Number of sequence ${s} per QC step`},yAxis:{min:0,title:{text:"Count"}},xAxis:{categories:[`Initial ${s}`,"Trimming","Length filtering","Ambiguous base filtering",`${o} subsampled for QC analysis`]},plotOptions:{series:{stacking:"normal"}},credits:{enabled:!1},series:[{name:`${o} filtered out`,data:c,color:"#CCCCD3"},{name:`${o} remaining`,data:i,color:"#058DC7"},{name:`${o} after sampling`,data:m,color:"#8dc7c7"}]};return n.createElement(b(),{highcharts:g,options:d,ref:r})},f=({analysisData:e,summaryData:t})=>{const a=(0,n.useRef)(null),i=(0,l.Z)(),{data:c,loading:m,error:u}=(0,r.Z)(`analyses/${i}/seq-length`,{},{},d.B5.TSV);if(m)return n.createElement(s.Z,{size:"large"});if(u)return n.createElement(o.Z,{error:u});if(!c)return n.createElement(s.Z,null);const p=c.map((([e,t])=>[Number(e),Number(t)])),v=Math.max(...p.map((([e])=>e))),f="assembly"===e.attributes["experiment-type"],h=f?"Contigs":"Reads",y={chart:{marginLeft:78,style:{fontFamily:"Helvetica"},zoomType:"x"},title:{text:`${h} length histogram`,style:{fontSize:16,fontWeight:"bold"}},yAxis:{title:{text:"Number of "+(f?"contigs":"reads")}},xAxis:{min:0,max:100*(Math.floor(v/100)+1),plotBands:null===t?[]:[{from:Number(t.average_length)-Number(t.standard_deviation_length),to:Number(t.average_length)+Number(t.standard_deviation_length),color:"rgba(128, 128, 128, .2)",label:{text:`Standard Deviation<br/>Â±${Number(t.standard_deviation_length).toFixed(2)}`,style:{color:"#666666",fontSize:"0.8em"}}}]},series:[{name:h,data:p,color:"#058dc7"}],legend:{enabled:!1},credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}}};return n.createElement(b(),{highcharts:g,options:y,ref:a})},h=()=>{const e=(0,n.useRef)(null),t=(0,l.Z)(),{data:a,loading:i,error:c}=(0,r.Z)(`analyses/${t}/nucleotide-distribution`,{},{},d.B5.TSV);if(i)return n.createElement(s.Z,{size:"large"});if(c)return n.createElement(o.Z,{error:c});if(!a)return n.createElement(s.Z,null);const m={pos:[],A:[],G:[],T:[],C:[],N:[]},u={A:"rgb(16, 150, 24)",G:"rgb(255, 153, 0)",C:"rgb(51, 102, 204)",T:"rgb(220, 57, 18)",N:"rgb(138, 65, 23)"},p=a[0];a.slice(1).forEach((e=>{e.forEach(((e,t)=>{m[p[t]].push(Number(e))}))}));const v={chart:{type:"area",style:{fontFamily:"Helvetica"}},title:{text:"Nucleotide position histogram",style:{fontSize:16,fontWeight:"bold"}},xAxis:{categories:m.pos,tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{min:0,max:100,title:{enabled:!1}},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}},tooltip:{shared:!0},series:["A","T","C","G","N"].map((e=>({name:e,data:m[e],color:u[e]}))),credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}}};return n.createElement(b(),{highcharts:g,options:v,ref:e})},y=({analysisData:e,summaryData:t})=>{const a=(0,n.useRef)(null),i=(0,l.Z)(),{data:c,loading:m,error:u}=(0,r.Z)(`analyses/${i}/gc-distribution`,{},{},d.B5.TSV);if(m)return n.createElement(s.Z,{size:"large"});if(u)return n.createElement(o.Z,{error:u});if(!c)return n.createElement(s.Z,null);const p=c.map((([e,t])=>[Number(e),Number(t)])),v="assembly"===e.attributes["experiment-type"],f=v?"Contigs":"Reads",h={chart:{style:{fontFamily:"Helvetica"},zoomType:"x"},title:{text:`${f} GC distribution`,style:{fontSize:16,fontWeight:"bold"}},yAxis:{title:{text:"Number of "+(v?"contigs":"reads")}},xAxis:{min:0,max:100,plotBands:null===t?[]:[{from:Number(t.average_gc_content)-Number(t.standard_deviation_gc_content),to:Number(t.average_gc_content)+Number(t.standard_deviation_gc_content),color:"rgba(128, 128, 128, .2)",borderColor:"#000000",label:{text:`Standard Deviation<br/>Â±${Number(t.standard_deviation_gc_content).toFixed(2)}`,style:{color:"#666666",fontSize:"0.8em"}}}]},series:[{name:f,data:p,color:"#058dc7"}],legend:{enabled:!1},credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}}};return n.createElement(b(),{highcharts:g,options:h,ref:a})},E=({summaryData:e})=>{const t=(0,n.useRef)(null),a={chart:{type:"bar",marginTop:0,height:120},title:!1,xAxis:{categories:["Minimum","Average","Maximum"],title:{enabled:!1},lineColor:"#595959",tickColor:""},yAxis:{min:0,max:100*(Math.floor(Number(e.length_max)/100)+1),title:{text:"Sequence length (bp)"},plotBands:[{from:Number(e.average_length)-Number(e.standard_deviation_length),to:e.average_length+Number(e.standard_deviation_length),color:"rgba(128, 128, 128, .2)"}]},plotOptions:{series:{grouping:!1,shadow:!1,borderWidth:0}},series:[{name:"Length",data:[{y:Number(e.length_min),x:0,color:"rgb(114, 191, 63)"},{y:Number(e.average_length),x:1,color:"rgb(63, 114, 191)"},{y:Number(e.length_max),x:2,color:"rgb(114, 63, 191)"}],pointPadding:-.2,tooltip:{pointFormatter(){return`<span style="color:${this.color}">â</span> ${this.category}: <b>${this.y.toFixed(2)}</b><br/>`}}}],legend:{enabled:!1},credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}},exporting:{enabled:!1}};return n.createElement(b(),{highcharts:g,options:a,ref:t})},N=({summaryData:e})=>{const t=(0,n.useRef)(null),a={chart:{type:"bar",marginTop:0,height:150},title:!1,xAxis:{categories:["Content"],title:{enabled:!1},lineColor:"#595959",tickColor:""},yAxis:{min:0,max:100,title:{enabled:!1},plotBands:[{from:Number(e.average_gc_content)-Number(e.standard_deviation_gc_content),to:Number(e.average_gc_content)+Number(e.standard_deviation_gc_content),color:"rgba(128, 128, 128, .2)"}]},plotOptions:{series:{grouping:!1,shadow:!1,borderWidth:0}},series:[{name:"GC content",pointPadding:.25,color:"rgb(63, 114, 191)",tooltip:{pointFormatter(){return`<span style="color:${this.color}">â</span> ${this.series.name}: <b>${this.y.toFixed(2)}%</b><br/>`}},data:[Number(e.average_gc_content)]},{name:"AT content",color:"rgb(114, 63, 191)",pointPadding:.25,threshold:Number(e.average_gc_content),tooltip:{pointFormatter(){const t=(100-Number(e.average_gc_content)).toFixed(2);return`\n              <span style="color:${this.color}">â</span>\n              ${this.series.name}: <b>${t}%</b>\n              <br/>`}},data:[100]}],credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}},exporting:{enabled:!1}};return n.createElement(b(),{highcharts:g,options:a,ref:t})},_=({analysisData:e})=>{const t=(0,l.Z)(),{data:a,loading:i,error:c}=(0,r.Z)(`analyses/${t}/summary`,{},{},d.B5.TSV);if(i)return n.createElement(s.Z,{size:"large"});if(c)return n.createElement(o.Z,{error:c});if(!a)return n.createElement(s.Z,null);const m=Object.fromEntries(a),u="assembly"===e.attributes["experiment-type"],g=u?"contig":"read",p=u?"contigs":"reads";return n.createElement("div",{className:"vf-stack vf-stack--200"},n.createElement("p",null,"The chart below shows the number of ",p," which pass the quality control steps in the pipeline. Paired-end sequences may have been merged, in which case the initial number of ",p," may differ from the number given by ENA."),n.createElement(v,{analysisData:e,summaryData:m}),Number(e.attributes["pipeline-version"])>2&&n.createElement(n.Fragment,null,n.createElement("p",null,"The histograms below show the distributions of sequence lengths (left) and percentage GC content (right) for the sequences having passed quality control. Note that for large files, the distributions were compiled from a random subset of 2 million",p,". The standard deviations are shown on each plot. The bar chart underneath each graph indicates the minimum, mean and maximum length and mean GC and AT content, respectively."),n.createElement("div",{className:"vf-grid vf-grid__col-2"},n.createElement("div",{className:"vf-stack"},n.createElement(f,{analysisData:e,summaryData:m}),n.createElement(E,{summaryData:m})),n.createElement("div",{className:"vf-stack"},n.createElement(y,{analysisData:e,summaryData:m}),n.createElement(N,{summaryData:m}))),n.createElement("p",null,'The graph below show the relative abundance of nucletotides (A, C, G, T, or ambiguous base "N") at each position starting from the beginning of each ',g," up to the first 500 base pairs."),n.createElement(h,null)))};var k=a(6050),C=a(4897),x=a.n(C),w=a(8696),Z=a(7565),P=a(2054);const $=n.createContext({contigsQueryData:{data:null,loading:!1,error:null},queryParameters:{},setQueryParameters:P.Z});var F=a(2069);const O=e=>e.split("cursor=")[1].split("&")[0],A=({paginationLinks:e,handleCursor:t})=>{const a=!!e.prev,r=!!e.next;return n.createElement("section",{className:"mg-table-footer"},n.createElement("nav",{className:"vf-pagination","aria-label":"Pagination"},n.createElement("ul",{className:"vf-pagination__list"},n.createElement("li",{className:"vf-pagination__item vf-pagination__item--previous-page"},n.createElement("button",{disabled:!a,type:"button",onClick:()=>t(O(e.prev)),className:"vf-button vf-button--link vf-pagination__link"},"Previous",n.createElement("span",{className:"vf-u-sr-only"}," page"))),n.createElement("li",{className:"vf-pagination__item vf-pagination__item--next-page"},n.createElement("button",{disabled:!r,type:"button",onClick:()=>t(O(e.next)),className:"vf-button vf-button--link vf-pagination__link"},"Next",n.createElement("span",{className:"vf-u-sr-only"}," page"))))))},D=({annotationType:e,present:t})=>{let a;const r=e[0].toUpperCase();switch(e){case"cog":a="#3b6fb6";break;case"kegg":a="#18974c";break;case"pfam":a="#193f90";break;case"interpro":a="#734595";break;case"go":a="#f49e17";break;case"antismash":a="#b65417";break;default:a="#8d8f8e"}t||(a+="55");const l=`${t?"Has":"Doesât have"} ${e} annotations`;return n.createElement(Z.Z,{content:l},n.createElement("div",{className:"emg-contig-feature-flag vf-text vf-text-body--4",style:{borderColor:a,color:a}},r))},T=()=>{const{contigsQueryData:e,setQueryParameters:t,queryParameters:a}=(0,n.useContext)($),{data:r,loading:l,error:i}=e||{},c=(0,n.useMemo)((()=>[{id:"contig_id",Header:"Name",accessor:e=>e.attributes["contig-id"],Cell:({cell:e})=>n.createElement("button",{className:"vf-button vf-button--link vf-button--sm contig-id-button",type:"button",onClick:()=>t(Object.assign(Object.assign({},a),{selectedContig:e.value}))},e.value,n.createElement(F.Z,null))},{id:"length",Header:"Length (bp)",accessor:e=>e.attributes.length,Cell:({cell:e})=>n.createElement("span",null,e.value)},{id:"coverage",Header:"Coverage",accessor:e=>e.attributes.coverage,Cell:({cell:e})=>n.createElement("span",null,e.value)},{id:"features",Header:"Features",accessor:e=>e.attributes,Cell:({cell:e})=>{const t=Object.entries(e.value).filter((([e])=>e.startsWith("has-"))).map((([e,t])=>n.createElement(D,{key:e,annotationType:e.substring(4),present:!!t})));return n.createElement("div",{className:"emg-contig-feature-flags"},t)}}]),[a,t]);return l&&!r?n.createElement(s.Z,{size:"large"}):i||!r?n.createElement(o.Z,{error:i}):n.createElement("div",null,n.createElement(w.Z,{cols:c,data:r,showPagination:!1,title:()=>n.createElement(n.Fragment,null,"Assembly Contigs",n.createElement("span",{className:"mg-number"},r.meta.pagination.count)),initialPage:0,className:"mg-contigs-table",namespace:"contigs_",loading:l}),n.createElement(A,{paginationLinks:r.links,handleCursor:e=>t(Object.assign(Object.assign({},a),{contigsPageCursor:e}))}))};var S=a(2119),B=a(7927),G=a(3253),R=a.n(G),I=a(4063);class j extends I.default{constructor(){super("emgGFF"),this.version(1).stores({gffs:"++id, name"})}}const q=new j;var z=a(1039),V=a(9521);const H=({cols:e,data:t,className:a="",sortable:r=!1,loading:l=!1,isStale:o=!1})=>{const{getTableProps:i,getTableBodyProps:c,headerGroups:m,rows:u,prepareRow:d}=(0,V.useTable)({columns:e,data:t},V.useSortBy),g=(0,n.useRef)(null);return l&&!o?n.createElement(s.Z,{size:"small"}):n.createElement("section",null,n.createElement("div",{className:"mg-table-overlay-container"},n.createElement("div",{className:l&&o?"mg-table-overlay":void 0}),n.createElement("table",Object.assign({},i,{className:`vf-table--striped mg-table ${a}`,ref:g}),n.createElement("thead",{className:"vf-table__header"},m.map((e=>n.createElement("tr",Object.assign({},e.getHeaderGroupProps(),{className:"vf-table__row"}),e.headers.map((e=>n.createElement("th",Object.assign({},r&&e.canSort?e.getHeaderProps(e.getSortByToggleProps()):{key:e.id},{className:"vf-table__heading"}),e.render("Header"),r&&e.canSort&&n.createElement(n.Fragment,null,"Â ",n.createElement("span",null,e.isSorted?e.isSortedDesc?n.createElement("i",{className:"icon icon-common icon-sort-down"}):n.createElement("i",{className:"icon icon-common icon-sort-up"}):n.createElement("i",{className:"icon icon-common icon-sort"})))))))))),n.createElement("tbody",Object.assign({},c(),{className:"vf-table__body"}),u.map((e=>(d(e),n.createElement("tr",Object.assign({},e.getRowProps(),{className:"vf-table__row"}),e.cells.map((e=>n.createElement("td",Object.assign({},e.getCellProps(),{className:"vf-table__cell"}),e.render("Cell"))))))))))))};var L=a(2750),M=function(e,t,a,n){return new(a||(a=Promise))((function(r,l){function s(e){try{i(n.next(e))}catch(e){l(e)}}function o(e){try{i(n.throw(e))}catch(e){l(e)}}function i(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(s,o)}i((n=n.apply(e,t||[])).next())}))};R().setAppElement("#root");const U={overlay:{zIndex:1e4},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)"}},Q=({igvBrowser:e})=>{const[t,a]=(0,n.useState)(!1),[r,l]=(0,n.useState)(null),[s,o]=(0,S.B)({gffComparisonId:null},{gffComparisonId:Number}),{setQueryParameters:i,queryParameters:c}=(0,n.useContext)($),m=(0,z.useLiveQuery)((()=>q.gffs.toArray()));(0,n.useEffect)((()=>{s.gffComparisonId&&q.gffs.get(s.gffComparisonId).then((t=>{void 0===t?o({gffComparisonId:null}):(e.removeTrackByName(t.name),e.loadTrack({name:t.name,type:"annotation",url:`data:application/octet-stream;base64,${t.encodedGFF}`,format:"gff3",filterTypes:[],removable:!1}))}))}),[s,e,o]);const u=(0,n.useMemo)((()=>[{id:"name",Header:"GFF Filename",accessor:e=>e.name,Cell:({cell:e,row:t})=>n.createElement("button",{className:"vf-button vf-button--link vf-button--sm contig-id-button",type:"button",onClick:()=>M(void 0,void 0,void 0,(function*(){const e=yield q.gffs.get(t.original.id);i(Object.assign(Object.assign({},c),{gffComparisonId:e.id})),a(!1)}))},e.value,n.createElement(F.Z,null))},{id:"size",Header:"File size (Kb)",accessor:e=>e.size,Cell:({cell:e})=>n.createElement("span",null,e.value)},{id:"added",Header:"Added",accessor:e=>e.added,Cell:({cell:e})=>{var t;return n.createElement("span",null,null===(t=e.value)||void 0===t?void 0:t.toLocaleString())}},{id:"del",Header:"Remove",accessor:e=>e.id,Cell:({cell:e})=>n.createElement("button",{className:"vf-button vf-button--link vf-button--sm",type:"button",onClick:()=>q.gffs.delete(e.value)},"Remove")}]),[s,o]);function d(e){return M(this,void 0,void 0,(function*(){if(!e)return;const t=yield function(e){return t=this,a=void 0,r=function*(){return new Promise((t=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(btoa(e))},a.readAsText(e)}))},new((n=void 0)||(n=Promise))((function(e,l){function s(e){try{i(r.next(e))}catch(e){l(e)}}function o(e){try{i(r.throw(e))}catch(e){l(e)}}function i(t){var a;t.done?e(t.value):(a=t.value,a instanceof n?a:new n((function(e){e(a)}))).then(s,o)}i((r=r.apply(t,a||[])).next())}));var t,a,n,r}(e);try{yield q.gffs.add({name:e.name,size:e.size,added:new Date(Date.now()),encodedGFF:t}),l(null)}catch(e){l(`GFF upload error: ${e}`)}}))}return n.createElement("div",null,n.createElement(R(),{isOpen:t,onRequestClose:()=>a(!1),contentLabel:"Example Modal",style:U},n.createElement("div",{className:"vf-stack vf-stack--800"},n.createElement("h1",null,"Compare a GFF to the contig"),n.createElement("form",{className:"vf-stack vf-stack--400",action:"#",method:"get"},n.createElement("div",{className:"vf-form__item vf-stack"},n.createElement("label",{htmlFor:"upload-picker",className:"vf-form__label vf-form__label--required"},n.createElement("h2",null,"Upload a GFF file from your computer")),n.createElement("p",{className:"vf-form__helper"},"The GFF will be stored in your browser, not sent to MGnify servers."),n.createElement(L.Z,{onChange:e=>d(e.target.files[0]),accept:".gff,.gff3"}),r&&n.createElement("p",{className:"vf-form__helper vf-form__helper--error"},r))),n.createElement("div",{className:"vf-stack vf-stack--200"},n.createElement("h2",null,"Previously uploaded GFFs"),n.createElement("p",{className:"vf-form__helper"},"Click the GFFâs name to view it in the browser"),n.createElement(H,{cols:u,data:m})))),n.createElement("button",{className:"vf-button vf-button--secondary vf-button--sm",type:"button",onClick:()=>a(!0)},"Load a GFF"))};var W=a(7762),X=a(2379);const K=({contig:e})=>{const t=(0,l.Z)(),{config:a}=(0,n.useContext)(k.Z),r=e.attributes["contig-id"],i=`${a.api}analyses/${e.attributes.accession}/contigs/${r}`,{data:c,loading:m,error:u}=(0,d.ZP)(i,d.B5.TXT),g=e.attributes["has-antismash"],p=e.attributes["contig-name"],[b,v]=(0,n.useState)(null),f=(0,n.useCallback)((e=>{const l={showChromosomeWidget:!1,showTrackLabelButton:!0,showTrackLabels:!0,showCenterGuide:!1,reference:{indexed:!1,fastaURL:i},tracks:[{name:p,type:"mgnify-annotation",format:"gff3",url:`${a.api}analyses/${t}/contigs/${r}/annotations`,displayMode:"EXPANDED",label:"Functional annotation",colorAttributes:[["Default",""],["COG","COG"],["GO","GO"],["KEGG","KEGG"],["Pfam","Pfam"],["InterPro","InterPro"]],colorBy:void 0,defaultColour:void 0,labelBy:void 0}],showLegend:!0,legendParent:"#contig"};g&&l.tracks.push({colorAttributes:[],name:void 0,type:"mgnify-annotation",format:"gff3",displayMode:"EXPANDED",url:`${a.api}analyses/${t}/contigs/${r}/annotations?antismash=True`,label:"antiSMASH",colorBy:"as_type",defaultColour:"#BEBEBE",labelBy:"as_gene_clusters"}),null!==e&&x().createBrowser(e,l).then((e=>{e.on("trackclick",((e,t)=>W.renderToString(n.createElement(X.Z,{data:t})))),v(e)}))}),[i,p,a.api,t,r,g]);return m?n.createElement(s.Z,{size:"small"}):u?n.createElement(o.Z,{error:u}):c?n.createElement("div",{id:"contig"},n.createElement("div",{ref:f}),n.createElement(Q,{igvBrowser:b})):n.createElement(s.Z,null)},Y=()=>{const e=(0,l.Z)(),[t,a]=(0,S.B)({contigsPageCursor:"",selectedContig:"",gffComparisonId:""}),{data:i,loading:c,error:m}=(0,r.Z)(`analyses/${e}/contigs`,{cursor:t.contigsPageCursor},{}),u=(0,n.useMemo)((()=>({contigsQueryData:{data:i,loading:c,error:m},queryParameters:t,setQueryParameters:a})),[i,m,c,t,a]),d=(0,n.useMemo)((()=>{var e,a,n;let r;if(!i)return null;const l=t.selectedContig||(null===(n=null===(a=null===(e=i.data)||void 0===e?void 0:e[0])||void 0===a?void 0:a.attributes)||void 0===n?void 0:n["contig-id"]);return l&&(r=(0,B.Z)(i.data,(e=>e.attributes["contig-id"]===l)),r)?r:null}),[i,t]);return(0,n.useEffect)((()=>{d&&d.attributes["contig-id"]!==t.selectedContig&&a(Object.assign(Object.assign({},t),{selectedContig:d.attributes["contig-id"]}))})),(0,n.useEffect)((()=>{if(t.selectedContig&&i&&!d){const{selectedContig:e}=t,n=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(a[n[r]]=e[n[r]])}return a}(t,["selectedContig"]);a(n)}}),[i,d,t,a]),c?n.createElement(s.Z,{size:"large"}):m?n.createElement(o.Z,{error:m}):i&&d?n.createElement("div",{className:"vf-stack vf-stack--800"},n.createElement($.Provider,{value:u},n.createElement("section",null,n.createElement("div",{className:"vf-stack"},n.createElement("details",{open:!0},n.createElement("summary",null,n.createElement("b",null,"Contig browser")),n.createElement(K,{contig:d})))),n.createElement("section",null,n.createElement(T,null)))):n.createElement(s.Z,null)},J=({tabs:e,queryParameter:t,defaultValue:a})=>{const[r,l]=(0,S.B)({[t]:a}),s=r[t];return n.createElement("div",{className:"vf-tabs mg-search-tabs"},n.createElement("ul",{className:"vf-tabs__list"},e.map((({label:e,to:a})=>n.createElement("li",{className:"vf-tabs__item",key:a},n.createElement("button",{type:"button",className:"vf-tabs__link mg-button-as-tab "+(a===s?"is-active":""),onClick:()=>l(Object.assign(Object.assign({},r),{[t]:a}))},"string"==typeof e?e:n.createElement(e,null)))))))};var ee=a(5457);const te=e=>(t,a)=>{switch(e){case"i":case"y":case"percentage":return Number(t[e])-Number(a[e]);case"-i":case"-y":case"-percentage":return Number(a[e.slice(1)])-Number(t[e.slice(1)]);case"name":return a.name>=t.name?-1:1;case"-name":return t.name>=a.name?-1:1;case"lineage":return a.lineage[0]>=t.lineage[0]?-1:1;case"-lineage":return t.lineage[0]>=a.lineage[0]?-1:1;default:return 0}},ae=({clusteredData:e})=>{const[{order:t}]=(0,S.B)({order:""}),a=[{Header:"",accessor:"i"},{id:"name",Header:"Phylum",accessor:e=>e,Cell:({cell:e})=>n.createElement(n.Fragment,null,n.createElement("div",{style:{width:"1rem",height:"1rem",display:"inline-block",backgroundColor:e.value.color,verticalAlign:"sub"}},"Â ")," ",e.value.name)},{id:"lineage",Header:"Domain",accessor:"lineage[0]"},{Header:"Unique OTUs",accessor:"y"},{Header:"%",accessor:"percentage"}];return n.createElement(w.Z,{cols:a,data:e.sort(te(t)),initialPageSize:100,className:"mg-anlyses-table",showPagination:!1,sortable:!0})};function ne(e,t){const a=[];let n=0;for(;n<t.length;)a.push(e[Math.min(n,e.length-1)]),n+=1;return a}const re=({clusteredData:e,title:t,showLegend:a=!1})=>{const r=(0,n.useRef)(null),l=function(e,t){const a=e.slice(0,10);if(e.length>10){const t={name:"Other",lineageA:[],lineage:[],y:0,i:11,color:"grey"};e.slice(10).forEach((e=>{t.y+=e.y,-1===t.lineageA.indexOf(e.lineage[0])&&t.lineageA.push(e.lineage[0])})),t.lineage=[t.lineageA.join(", ")],a.push(t)}return a}(e),s={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:t},tooltip:{pointFormat:"<b>{point.y}</b> {series.name} ({point.percentage:.2f}%)"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.2f} %",style:{color:"black"}},colors:ne(ee.DC,l),showInLegend:a}},credits:{enabled:!1},series:[{name:"reads",colorByPoint:!0,data:l}]};return a&&(s.legend={title:{text:"Click to hide"},align:"right",verticalAlign:"middle",layout:"vertical",labelFormatter(){return this.name.length>15?`${this.name.slice(0,15)}...`:this.name}}),n.createElement(b(),{highcharts:g,options:s,ref:r})};function le(e,t=0){const a={};let n=0;return e.forEach((e=>{const r=e.attributes,l=String(r.lineage).split(":");let s;s=l.length<t?l[l.length-1]:l[t],t>0&&["","Bacteria","Eukaryota","other_sequences",void 0].includes(s)&&(s="Bacteria"===l[0]?"Unassigned Bacteria":"Unassigned"),"Unusigned"===l[0]&&1===l.length&&(s="Unassigned");const o=Number(r.count);n+=o,s in a?a[s].v+=o:a[s]={v:o,l}})),Object.entries(a).map((([e,{v:t,l:a}])=>({name:e,y:t,lineage:a}))).sort(((e,t)=>t.y-e.y)).map(((e,t)=>Object.assign(Object.assign({},e),{i:t+1,color:ee.DC[Math.min(t,ee.DC.length-1)],percentage:(100*e.y/n).toFixed(2)})))}const se=({accession:e,category:t,chartType:a})=>{const{data:l,loading:i,error:c}=(0,r.Z)(`analyses/${e}/taxonomy${t}`);if(i)return n.createElement(s.Z,null);if(c)return n.createElement(o.Z,{error:c});const m=le(l.data,2),u=le(l.data),d=["","/ssu","/lsu"].includes(t);return n.createElement("div",{className:"vf-stack"},n.createElement("div",{className:"vf-grid "+(d?"vf-grid__col-2":"")},"pie"===a&&d&&n.createElement(re,{clusteredData:u,title:"Domain composition"}),"pie"===a&&n.createElement(re,{clusteredData:m,title:"Phylum composition",showLegend:!0}),"column"===a&&n.createElement("b",null,"column"),"stacked-column"===a&&n.createElement("b",null,"stacked-column")),n.createElement("div",null,n.createElement(ae,{clusteredData:m})))},oe=[{label:"Krona",to:"krona"},{label:"Pie",to:"pie"},{label:"Column",to:"column"},{label:"Stacked Column",to:"stacked-column"}],ie="type",ce="krona",me=({accession:e})=>{const{data:t,loading:a,error:l}=(0,r.Z)(`analyses/${e}/taxonomy/overview`),[i]=(0,S.B)({[ie]:ce}),c=null==t?void 0:t.data,m=(null==c?void 0:c.taxonomy_ssu_count)>0||(null==c?void 0:c.taxonomy_count)>0,u=(null==c?void 0:c.taxonomy_lsu_count)>0,d=(null==c?void 0:c.taxonomy_itsonedb_count)>0,g=(null==c?void 0:c.taxonomy_itsunite_count)>0,p=!(null==c?void 0:c.taxonomy_ssu_count)&&(null==c?void 0:c.taxonomy_count)>0,{config:b}=(0,n.useContext)(k.Z),[v,f]=(0,n.useState)("");if((0,n.useEffect)((()=>{a||l||!t||f((d?"/itsonedb":g&&"/unite")||m&&p&&"/ssu"||u&&"/lsu"||"")}),[t,a,l,g,d,u,m,p]),a)return n.createElement(s.Z,{size:"large"});if(l)return n.createElement(o.Z,{error:l});const h=e=>{f(e.target.value)};return n.createElement("div",{className:"vf-stack"},n.createElement("div",null,(m||u)&&n.createElement("fieldset",{className:"vf-form__fieldset vf-stack vf-stack--400 mg-fieldbox",style:{width:"15rem"}},n.createElement("legend",{className:"vf-form__legend"},"rRNA"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"smallrRNA",name:"tax-results",value:"/ssu",checked:"/ssu"===v,onChange:h})," ","small subunit rRNA"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"largerRNA",name:"tax-results",value:"/lsu",checked:"/lsu"===v,onChange:h})," ","large subunit rRNA")),(d||g)&&n.createElement("fieldset",{className:"vf-form__fieldset vf-stack vf-stack--400 mg-fieldbox",style:{width:"15rem"}},n.createElement("legend",{className:"vf-form__legend"},"ITS"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"smallrRNA",name:"tax-results",value:"/itsonedb",checked:"/itsonedb"===v,onChange:h})," ","ITS with ITSoneDB"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"largerRNA",name:"tax-results",value:"/unite",checked:"/unite"===v,onChange:h})," ","ITS1/2 with UNITE"))),n.createElement("div",null,'These are the results from the taxonomic analysis steps of our pipeline. You can switch between different views of the data using the menu of icons below (pie, bar, stacked and interactive krona charts). The data used to build these charts can be found under the "Download" tab.'),n.createElement(J,{tabs:oe,queryParameter:ie,defaultValue:ce}),n.createElement("div",{className:"vf-tabs-content"},"krona"===i.type?n.createElement("object",{className:"krona_chart",data:`${b.api}analyses/${e}/krona${v}?collapse=false`,type:"text/html",title:"Interactive Krona chart"}):n.createElement(se,{accession:e,category:v,chartType:String(i.type)})))};var ue=a(1274);const de=e=>"assembly"===e.attributes["experiment-type"],ge=e=>Number(e.attributes["pipeline-version"])>=5,pe=e=>"amplicon"!==e.attributes["experiment-type"],be=()=>{const e=(0,l.Z)(),{data:t,loading:a,error:c}=(0,r.Z)(`analyses/${e}`,{include:"downloads"});if(a)return n.createElement(s.Z,{size:"large"});if(c)return n.createElement(o.Z,{error:c});if(!t)return n.createElement(s.Z,null);const{data:d,included:g}=t,p=[{label:"Overview",to:"#overview"},{label:"Quality control",to:"#qc"},{label:"Taxonomic analysis",to:"#taxonomic"},pe(d)?{label:"Functional analysis",to:"#functional"}:null,(b=g,b.some((e=>{var t;return"Statistics"===(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t["group-type"])}))?{label:"Abundance and comparison",to:"#abundance"}:null),de(d)&&ge(d)?{label:"Pathways/Systems",to:"#path-systems"}:null,de(d)&&ge(d)?{label:"Contig Viewer",to:"#contigs-viewer"}:null,{label:"Download",to:"#download"}].filter(Boolean);var b;return n.createElement("section",{className:"vf-content"},n.createElement("h2",null,"Analysis ",e),n.createElement("h4",null,n.createElement(m.rU,{to:de(d)?`/assemblies/${d.relationships.assembly.data.id}`:`/runs/${d.relationships.run.data.id}`},"Other Analyses")),n.createElement(i.Z,{tabs:p}),n.createElement("section",{className:"vf-grid"},n.createElement("div",{className:"vf-stack vf-stack--200"},n.createElement(ue.Z,{hash:"#overview",isDefault:!0},n.createElement(u,{data:d})),n.createElement(ue.Z,{hash:"#qc"},n.createElement(_,{analysisData:d})),n.createElement(ue.Z,{hash:"#contigs-viewer"},n.createElement(Y,null)),n.createElement(ue.Z,{hash:"#taxonomic"},n.createElement(me,{accession:e})))))}}}]);
//# sourceMappingURL=597.32c32e24.chunk.js.map