{"version":3,"file":"js/633.96dd7a27.chunk.js","mappings":"gJAsBA,MAAMA,EAAkB,CACtBC,aAAc,yBACd,0BAA2B,+BAC3BC,WAAY,mBACZC,UAAW,yBACXC,WAAY,oBAGRC,EAID,EAAGC,MAAAA,EAAOC,IAAAA,EAAKC,YAAAA,MAClB,IAAKF,EAAO,OAAO,KACnB,MAAMG,EAAQH,EAAMI,MAAM,KAC1B,OACE,sBAAIC,UAAU,WACXF,EAAMG,KAAKC,IACV,MAAMC,EAAON,EAAcO,mBAAmBF,GAAQA,EACtD,OACE,sBAAIG,IAAKH,EAAMF,UAAU,iCACtBJ,EAAM,gBAAC,IAAO,CAACU,KAAM,GAAGV,IAAMM,KAASC,GAAkBA,QAYhEI,EAAiBC,IAIrB,MAAMC,EACwB,iBAArBD,EAAWC,MACdC,SAASF,EAAWC,MAAO,IAC3BD,EAAWC,MACXE,EACsB,iBAAnBH,EAAWG,IACdD,SAASF,EAAWG,IAAK,IACzBH,EAAWG,IACjB,IACEC,OAAOC,MAAMJ,KACbG,OAAOC,MAAMF,IACH,OAAVF,GACQ,OAARE,EAIF,OAAOG,KAAKC,MAAMJ,EAAMF,GAAS,IA6PnC,EA7D8D,EAC5DO,KAAAA,EACAC,kBAAAA,MAEA,MAAM,KAAEC,EAAI,KAAEC,EAAI,QAAEC,EAAO,WAAEC,GAlMZ,EACjBC,EACAC,KAEA,MAAMf,EAEFc,EAAQE,QAAO,CAACC,EAAMC,KAEpBA,EAAGR,OAAMO,EAAKC,EAAGR,KAAKS,eAAiBD,EAAG/B,OACvC8B,IACN,IAEGG,EAAiB,CACrBC,MAAO,wBACPb,KAAM,CACJ,CACEE,KAAM,aACNY,MACEtB,EAAWuB,UACX,KACE,gBAACrC,EAAa,CACZC,MAAOa,EAAWuB,SAClBnC,IAAI,oCAIZ,CACEsB,KAAM,OACNY,MACEtB,EAAWwB,MACX,KACE,gBAACtC,EAAa,CACZC,MAAOa,EAAWwB,KAClBpC,IAAI,oCAIZ,CACEsB,KAAM,OACNY,MACEtB,EAAWyB,MACX,KACE,gBAACvC,EAAa,CACZC,MAAOa,EAAWyB,KAClBrC,IAAI,gDAIZ,CACEsB,KAAM,SACNY,MAAOtB,EAAW0B,QAAU9B,mBAAmBI,EAAW0B,SAE5D,CACEhB,KAAM,MACNY,MACEtB,EAAW2B,KAAO,KAAO,gBAACzC,EAAa,CAACC,MAAOa,EAAW2B,QAE9D,CACEjB,KAAM,KACNY,MACEtB,EAAW4B,IACX,KACE,gBAAC1C,EAAa,CACZC,MAAOa,EAAW4B,GAClBxC,IAAI,0CAIZ,CACEsB,KAAM,WACNY,MACEtB,EAAW6B,UACX,KACE,gBAAC3C,EAAa,CACZC,MAAOa,EAAW6B,SAClBzC,IAAI,sDAIZ,CAEEsB,KAAM,YACNY,MACEtB,EAAW8B,UACVjD,EAAgBmB,EAAW8B,UAAY9B,EAAW8B,UAEvD,CAEEpB,KAAM,QACNY,MACEtB,EAAW+B,UACX,KACE,gBAAC7C,EAAa,CAACC,MAAOS,mBAAmBI,EAAW+B,cAG1D,CACErB,KAAM,UACNY,MACEtB,EAAWgC,kBACX,KAAO,gBAAC9C,EAAa,CAACC,MAAOa,EAAWgC,uBAI1CC,EAAY,CAChBZ,MAAO,kBACPb,KAAM,CACJ,CACEE,KAAM,OACNY,MAAOtB,EAAWkC,MAEpB,CACExB,KAAM,YACNY,MAAOtB,EAAWmC,WAEpB,CACEzB,KAAM,cACNY,MAAO,GAAGtB,EAAWC,SAASD,EAAWG,OAE3C,CACEO,KAAM,iBACNY,MAAOc,OAAOrC,EAAcC,OAK5BqC,EAAoB,CACxBhB,MAAO,iBACPb,KAAM,CACJ,CACEE,KAAM,gBACNY,MACEtB,EAAWsC,UACX,KACE,gBAAC,IAAO,CACNxC,KAAM,gDAAgDE,EAAWsC,YAEhEtC,EAAWsC,YAIpB,CACE5B,KAAM,oCACNY,MACmD,SAAjDtB,EAAWuC,kCACP,IAAM,4BACN,QAER,CACE7B,KACmD,SAAjDV,EAAWuC,kCACP,mBACA,GACNjB,MACmD,SAAjDtB,EAAWuC,kCACP,IAAM,gBAACrD,EAAa,CAACC,MAAOa,EAAWwC,wBACvC,IAAM,6BAEd,CACE9B,KAAM,uCACNY,MACsD,SAApDtB,EAAWyC,qCACP,IAAM,4BACN,QAER,CACE/B,KACsD,SAApDV,EAAWyC,qCACP,mBACA,GACNnB,MACsD,SAApDtB,EAAWyC,qCACP,IAAM,gBAACvD,EAAa,CAACC,MAAOa,EAAW0C,sBACvC,IAAM,+BAKZ7B,EAAa,CAACO,EAAgBa,GAKpC,OAJIlB,GACFF,EAAW8B,KAAKN,GAGX,CACL3B,KAAMV,EAAW4C,GACjBjC,KAAMX,EAAWW,KACjBC,QAASZ,EAAWY,QACpBC,WAAAA,IAQ0CgC,CAC1CrC,EACAC,GAEF,OACE,gCACE,yBAAOjB,UAAU,iCACf,2BAASA,UAAU,8BAA4B,WAC/C,6BACGkB,GACC,0BACE,sBAAIlB,UAAU,6BAA2B,MACzC,0BAAKkB,IAGRC,GACC,0BACE,sBAAInB,UAAU,6BAA2B,QACzC,0BACE,0BAAKmB,KAIVC,GACC,0BACE,sBAAIpB,UAAU,6BAA2B,WACzC,0BAAKoB,MAKZC,EAAWpB,KAAKqD,GACf,yBAAOtD,UAAU,gCAAgCK,IAAKiD,EAASzB,OAC5DyB,EAAStC,KAAKuC,QAAQC,KAAQA,EAAE1B,QAAO2B,OAAS,GAC/C,2BAASzD,UAAU,8BAChBsD,EAASzB,OAGd,6BACGyB,EAAStC,KACPf,KACC,EAAGiB,KAAMwC,EAAO5B,MAAAA,KACdA,GACE,sBAAIzB,IAAKqD,GACP,sBAAI1D,UAAU,6BAA6B0D,GAC3C,0BAAsB,iBAAV5B,EAAqBA,EAAQ,gBAACA,EAAK,UAItDyB,OAAOI,gB,8HCvTtB,MA0DA,EA1DgC,KAC9B,MAAOC,EAASC,IAAc,IAAAC,WAAS,GACjCC,GAAY,UACZ,OAAEC,IAAW,IAAAC,YAAW,MAExBC,EAAS,CACb,CACExB,KAAM,oBAEN9C,IAAK,GAAGoE,EAAOG,cAAcJ,eAAuBA,QACpDK,OAAQ,OACRC,MAAO,wBACPC,YAAa,WACbC,gBAAiB,CACf,CAAC,UAAW,IACZ,CAAC,MAAO,OACR,CAAC,UAAW,WACZ,CAAC,OAAQ,QACT,CAAC,OAAQ,QACT,CAAC,WAAY,YACb,CAAC,SAAU,aAIXC,EAAU,CACdC,sBAAsB,EACtBC,sBAAsB,EACtBC,iBAAiB,EACjBC,iBAAiB,EACjBC,oBAAoB,EACpBC,UAAW,CACTC,SAAU,GAAGf,EAAOG,cAAcJ,eAAuBA,QACzDiB,SAAU,GAAGhB,EAAOG,cAAcJ,eAAuBA,aAE3DG,OAAAA,EACAe,YAAY,EACZC,aAAc,mBAEVC,GAAS,IAAAC,QAAO,MAYtB,OAXA,IAAAC,YAAU,KACR,kBAAkBF,EAAOG,QAASd,GAASe,MAAMC,IAC/C3B,GAAW,GACX2B,EAAQC,GAAG,cAAc,CAACC,EAAS1E,IACjC,iBACE,gBAAC,IAAkB,CAACA,KAAMA,EAAMC,mBAAmB,YAKxD,IAED,uBAAKmC,GAAG,kBACLQ,GAAW,gBAAC,IAAO,CAAC+B,KAAK,UAC1B,uBAAK3F,UAAU,2BAA2B4F,IAAKT","sources":["webpack://mgportalv2/./src/components/Genomes/Browser/Popup/index.tsx","webpack://mgportalv2/./src/components/Genomes/Browser/index.tsx"],"sourcesContent":["import React from 'react';\nimport ExtLink from 'components/UI/ExtLink';\nimport './style.css';\n\ntype PropertyDataType = { name: string; value: string | number };\ntype GenomeBrowserPopupProps = {\n  data: PropertyDataType[];\n  hasMetaProteomics: boolean;\n};\ntype FormattedData = {\n  name?: string;\n  gene?: string;\n  product?: string;\n  properties: {\n    title: string;\n    data: {\n      name?: string;\n      Value?: string | React.ElementType;\n    }[];\n  }[];\n};\n\nconst antiSMASHLabels = {\n  biosynthetic: 'Core biosynthetic gene',\n  'biosynthetic-additional': 'Additional biosynthetic gene',\n  regulatory: 'Regulatory genes',\n  transport: 'Transport-related gene',\n  resistance: 'Resistance genes',\n};\n\nconst MultipleField: React.FC<{\n  value: string;\n  url?: string;\n  decodeValue?: boolean;\n}> = ({ value, url, decodeValue }) => {\n  if (!value) return null;\n  const parts = value.split(',');\n  return (\n    <ul className=\"vf-list\">\n      {parts.map((part) => {\n        const text = decodeValue ? decodeURIComponent(part) : part;\n        return (\n          <li key={part} className=\"igv-popup-multiple-field-item\">\n            {url ? <ExtLink href={`${url}${part}`}>{text}</ExtLink> : text}\n          </li>\n        );\n      })}\n    </ul>\n  );\n};\n\n/**\n * Calculate the property length.\n * @return {int} the length or undefined\n */\nconst getProtLength = (attributes: {\n  start?: string | number | null;\n  end?: string | number | null;\n}): number => {\n  const start =\n    typeof attributes.start === 'string'\n      ? parseInt(attributes.start, 10)\n      : attributes.start;\n  const end =\n    typeof attributes.end === 'string'\n      ? parseInt(attributes.end, 10)\n      : attributes.end;\n  if (\n    Number.isNaN(start) ||\n    Number.isNaN(end) ||\n    start === null ||\n    end === null\n  ) {\n    return undefined;\n  }\n  return Math.ceil((end - start) / 3);\n};\nconst formatData = (\n  rawData: PropertyDataType[],\n  withMetaProteomics: boolean\n): FormattedData => {\n  const attributes: {\n    [name: string]: string | null;\n  } = rawData.reduce((memo, el) => {\n    // eslint-disable-next-line no-param-reassign\n    if (el.name) memo[el.name.toLowerCase()] = el.value;\n    return memo;\n  }, {});\n\n  const functionalData = {\n    title: 'Functional annotation',\n    data: [\n      {\n        name: 'E.C Number',\n        Value:\n          attributes.ecnumber &&\n          (() => (\n            <MultipleField\n              value={attributes.ecnumber}\n              url=\"https://enzyme.expasy.org/EC/\"\n            />\n          )),\n      },\n      {\n        name: 'Pfam',\n        Value:\n          attributes.pfam &&\n          (() => (\n            <MultipleField\n              value={attributes.pfam}\n              url=\"https://pfam.xfam.org/family/\"\n            />\n          )),\n      },\n      {\n        name: 'KEGG',\n        Value:\n          attributes.kegg &&\n          (() => (\n            <MultipleField\n              value={attributes.kegg}\n              url=\"https://www.genome.jp/dbget-bin/www_bget?\"\n            />\n          )),\n      },\n      {\n        name: 'eggNOG',\n        Value: attributes.eggnog && decodeURIComponent(attributes.eggnog),\n      },\n      {\n        name: 'COG',\n        Value:\n          attributes.cog && (() => <MultipleField value={attributes.cog} />),\n      },\n      {\n        name: 'GO',\n        Value:\n          attributes.go &&\n          (() => (\n            <MultipleField\n              value={attributes.go}\n              url=\"https://www.ebi.ac.uk/ols/search?q=\"\n            />\n          )),\n      },\n      {\n        name: 'InterPro',\n        Value:\n          attributes.interpro &&\n          (() => (\n            <MultipleField\n              value={attributes.interpro}\n              url=\"https://www.ebi.ac.uk/interpro/entry/InterPro/'\"\n            />\n          )),\n      },\n      {\n        // antiSMASH\n        name: 'Gene type',\n        Value:\n          attributes.as_type &&\n          (antiSMASHLabels[attributes.as_type] || attributes.as_type),\n      },\n      {\n        // Notes are URL encoded during the GFF generation\n        name: 'Notes',\n        Value:\n          attributes.as_notes &&\n          (() => (\n            <MultipleField value={decodeURIComponent(attributes.as_notes)} />\n          )),\n      },\n      {\n        name: 'Cluster',\n        Value:\n          attributes.as_gene_clusters &&\n          (() => <MultipleField value={attributes.as_gene_clusters} />),\n      },\n    ],\n  };\n  const otherData = {\n    title: 'Feature details',\n    data: [\n      {\n        name: 'Type',\n        Value: attributes.type,\n      },\n      {\n        name: 'Inference',\n        Value: attributes.inference,\n      },\n      {\n        name: 'Start / End',\n        Value: `${attributes.start}/${attributes.end}`,\n      },\n      {\n        name: 'Protein length',\n        Value: String(getProtLength(attributes)),\n      },\n    ],\n  };\n\n  const metaproteomicData = {\n    title: 'Metaproteomics',\n    data: [\n      {\n        name: 'PRIDE Dataset',\n        Value:\n          attributes.pride_id &&\n          (() => (\n            <ExtLink\n              href={`https://www.ebi.ac.uk/pride/archive/projects/${attributes.pride_id}`}\n            >\n              {attributes.pride_id}\n            </ExtLink>\n          )),\n      },\n      {\n        name: 'Unique peptide-to-protein mapping',\n        Value:\n          attributes.unique_peptide_to_protein_mapping === 'True'\n            ? () => <div />\n            : 'None',\n      },\n      {\n        name:\n          attributes.unique_peptide_to_protein_mapping === 'True'\n            ? 'List of peptides'\n            : '',\n        Value:\n          attributes.unique_peptide_to_protein_mapping === 'True'\n            ? () => <MultipleField value={attributes.unambiguous_sequences} />\n            : () => <div />,\n      },\n      {\n        name: 'Ambiguous peptide-to-protein mapping',\n        Value:\n          attributes.ambiguous_peptide_to_protein_mapping === 'True'\n            ? () => <div />\n            : 'None',\n      },\n      {\n        name:\n          attributes.ambiguous_peptide_to_protein_mapping === 'True'\n            ? 'List of peptides'\n            : '',\n        Value:\n          attributes.ambiguous_peptide_to_protein_mapping === 'True'\n            ? () => <MultipleField value={attributes.ambiguous_sequences} />\n            : () => <div />,\n      },\n    ],\n  };\n\n  const properties = [functionalData, otherData];\n  if (withMetaProteomics) {\n    properties.push(metaproteomicData);\n  }\n\n  return {\n    name: attributes.id,\n    gene: attributes.gene,\n    product: attributes.product,\n    properties,\n  };\n};\n\nconst GenomeBrowserPopup: React.FC<GenomeBrowserPopupProps> = ({\n  data,\n  hasMetaProteomics,\n}) => {\n  const { name, gene, product, properties } = formatData(\n    data,\n    hasMetaProteomics\n  );\n  return (\n    <>\n      <table className=\"stack hover igv-popover-table\">\n        <caption className=\"igv-popover-section-header\">Feature</caption>\n        <tbody>\n          {name && (\n            <tr>\n              <td className=\"igv-popover-table-td-name\">ID</td>\n              <td>{name}</td>\n            </tr>\n          )}\n          {gene && (\n            <tr>\n              <td className=\"igv-popover-table-td-name\">Gene</td>\n              <td>\n                <em>{gene}</em>\n              </td>\n            </tr>\n          )}\n          {product && (\n            <tr>\n              <td className=\"igv-popover-table-td-name\">Product</td>\n              <td>{product}</td>\n            </tr>\n          )}\n        </tbody>\n      </table>\n      {properties.map((property) => (\n        <table className=\"stack hover igv-popover-table\" key={property.title}>\n          {property.data.filter((d) => !!d.Value).length > 0 && (\n            <caption className=\"igv-popover-section-header\">\n              {property.title}\n            </caption>\n          )}\n          <tbody>\n            {property.data\n              .map(\n                ({ name: pName, Value }) =>\n                  Value && (\n                    <tr key={pName}>\n                      <td className=\"igv-popover-table-td-name\">{pName}</td>\n                      <td>{typeof Value === 'string' ? Value : <Value />}</td>\n                    </tr>\n                  )\n              )\n              .filter(Boolean)}\n          </tbody>\n        </table>\n      ))}\n    </>\n  );\n};\n\nexport default GenomeBrowserPopup;\n","import React, { useEffect, useRef, useState, useContext } from 'react';\nimport ReactDOMServer from 'react-dom/server';\nimport igv from 'igv';\n\nimport UserContext from 'pages/Login/UserContext';\nimport useURLAccession from 'hooks/useURLAccession';\nimport Loading from 'components/UI/Loading';\nimport GenomeBrowserPopup from './Popup';\n\nconst GenomeBrowser: React.FC = () => {\n  const [loading, setLoading] = useState(true);\n  const accession = useURLAccession();\n  const { config } = useContext(UserContext);\n\n  const tracks = [\n    {\n      type: 'mgnify-annotation',\n      // name: downloadsModel.get('name'),\n      url: `${config.api}genomes/${accession}/downloads/${accession}.gff`,\n      format: 'gff3',\n      label: 'Functional annotation',\n      displayMode: 'EXPANDED',\n      colorAttributes: [\n        ['Default', ''],\n        ['COG', 'COG'],\n        ['Product', 'product'],\n        ['Pfam', 'Pfam'],\n        ['KEGG', 'KEGG'],\n        ['InterPro', 'InterPro'],\n        ['eggNOG', 'eggNOG'],\n      ],\n    },\n  ];\n  const options = {\n    showChromosomeWidget: false,\n    showTrackLabelButton: true,\n    showTrackLabels: true,\n    showCenterGuide: false,\n    showAllChromosomes: true,\n    reference: {\n      fastaURL: `${config.api}genomes/${accession}/downloads/${accession}.fna`,\n      indexURL: `${config.api}genomes/${accession}/downloads/${accession}.fna.fai`,\n    },\n    tracks,\n    showLegend: true,\n    legendParent: '#genome-browser',\n  };\n  const divRef = useRef(null);\n  useEffect(() => {\n    igv.createBrowser(divRef.current, options).then((browser) => {\n      setLoading(false);\n      browser.on('trackclick', (ignored, data) =>\n        ReactDOMServer.renderToString(\n          <GenomeBrowserPopup data={data} hasMetaProteomics={false} />\n        )\n      );\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return (\n    <div id=\"genome-browser\">\n      {loading && <Loading size=\"large\" />}\n      <div className=\"genome-browser-container\" ref={divRef} />\n    </div>\n  );\n};\n\nexport default GenomeBrowser;\n"],"names":["antiSMASHLabels","biosynthetic","regulatory","transport","resistance","MultipleField","value","url","decodeValue","parts","split","className","map","part","text","decodeURIComponent","key","href","getProtLength","attributes","start","parseInt","end","Number","isNaN","Math","ceil","data","hasMetaProteomics","name","gene","product","properties","rawData","withMetaProteomics","reduce","memo","el","toLowerCase","functionalData","title","Value","ecnumber","pfam","kegg","eggnog","cog","go","interpro","as_type","as_notes","as_gene_clusters","otherData","type","inference","String","metaproteomicData","pride_id","unique_peptide_to_protein_mapping","unambiguous_sequences","ambiguous_peptide_to_protein_mapping","ambiguous_sequences","push","id","formatData","property","filter","d","length","pName","Boolean","loading","setLoading","useState","accession","config","useContext","tracks","api","format","label","displayMode","colorAttributes","options","showChromosomeWidget","showTrackLabelButton","showTrackLabels","showCenterGuide","showAllChromosomes","reference","fastaURL","indexURL","showLegend","legendParent","divRef","useRef","useEffect","current","then","browser","on","ignored","size","ref"],"sourceRoot":""}