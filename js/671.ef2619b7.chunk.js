(self.webpackChunkmgportalv2=self.webpackChunkmgportalv2||[]).push([[671],{1699:(e,t,a)=>{"use strict";a.d(t,{Z:()=>o});var r=a(7294),n=a(7838);const s=()=>{window.location.reload()},o=({error:e})=>e&&e.type!==n.ZB.NullURL?r.createElement("div",{className:"vf-box vf-box-theme--primary vf-box--easy",style:{backgroundColor:"lemonchiffon"}},r.createElement("h3",{className:"vf-box__heading"},r.createElement("span",{className:"icon icon-common icon-exclamation-triangle"})," Error Fetching Data"),r.createElement("p",{className:"vf-box__text"},(null==e?void 0:e.type)===n.ZB.FetchError&&`There were problems with the request. [${e.error}]`,(null==e?void 0:e.type)===n.ZB.NotOK&&`The response from the server was not OK [Status: ${e.status}].`,(null==e?void 0:e.type)===n.ZB.JSONError&&`The recovered resource didn't follow the expected format [${e.error}].`),r.createElement("div",{className:"mg-right"},r.createElement("button",{type:"button",className:"vf-button vf-button--tertiary vf-button--sm ",onClick:s},"Refresh"))):null},4671:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var r=a(7294),n=a(3727),s=a(1153),o=a(8110);var l=a(402),i=a(1699);const c=({tabs:e})=>{const t=(0,s.TH)();return r.createElement("div",{className:"vf-tabs mg-search-tabs"},r.createElement("ul",{className:"vf-tabs__list"},e.map((({label:e,to:a})=>r.createElement("li",{className:"vf-tabs__item",key:e},r.createElement(n.rU,{className:"vf-tabs__link "+(a===t.pathname?"is-active":""),to:a},e))))))};var m=a(7762),u=a(7212),d=a(6529);var v=a(7838),b=a(150);const h=e=>e===u.Status.LOADING?r.createElement(l.Z,null):e===u.Status.FAILURE?r.createElement(i.Z,{error:{status:200,type:v.ZB.OtherError,error:e}}):null,f=({sample:e})=>r.createElement("div",{className:"vf-box vf-box--easy"},r.createElement("h3",{className:"vf-box__heading"},r.createElement("a",{href:`../samples/${e.id}`},e.id)),r.createElement("p",{className:"vf-box__text"},e.attributes["sample-desc"])),p=({accessions:e})=>r.createElement("div",{className:"vf-box vf-box--easy"},r.createElement("h3",{className:"vf-box__heading"},"Samples on this geographical location"),r.createElement("ul",{className:"vf-list"},e.map((e=>r.createElement("li",{ref:e},r.createElement("a",{href:`../samples/${e}`},e)))))),g=({data:e})=>{const t=(0,r.useRef)(),[a,n]=(0,r.useState)(null),s=(0,r.useRef)(null),o=(0,r.useRef)(new google.maps.InfoWindow),l=(0,r.useRef)(new google.maps.InfoWindow),i=(0,r.useRef)(new google.maps.LatLngBounds),c=(0,r.useRef)({});return(0,r.useEffect)((()=>{if(null===a){const e=new google.maps.Map(t.current,{maxZoom:10,minZoom:2});n(e)}}),[a]),(0,r.useEffect)((()=>{a&&e&&(s.current&&s.current.clearMarkers(),e.filter((({id:e})=>!(e in c.current))).forEach((e=>{const t={lat:e.attributes.latitude,lng:e.attributes.longitude},n=new google.maps.Marker({position:t,title:e.id});i.current.extend(t),n.addListener("click",(()=>{o.current.setContent(m.renderToString(r.createElement(f,{sample:e}))),o.current.open(a,n)})),c.current[e.id]=n})),s.current=new d.Z(a,Object.values(c.current),{imagePath:"https://googlemaps.github.io/js-markerclustererplus/images/m",maxZoom:10}),google.maps.event.addListener(s.current,"click",(function(e){this.prevZoom_+1<=this.getMaxZoom()||e.getSize()>=10||(l.current.setPosition(e.getCenter()),l.current.setContent(m.renderToString(r.createElement(p,{accessions:e.getMarkers().map((e=>e.getTitle()))}))),l.current.open(a))})),a.fitBounds(i.current))}),[a,e]),r.createElement("div",{ref:t,id:"map",style:{height:"100%"}})},E=({study:e})=>{const[t,a]=(0,r.useState)(200),{samples:n,total:s}=((e,t)=>{const[a,n]=(0,r.useState)(1),[s,l]=(0,r.useState)([]),[i,c]=(0,r.useState)(null),{data:m,isStale:u,loading:d,error:v}=(0,o.Z)("samples",{study_accession:e,page:a});return(0,r.useEffect)((()=>{var e,r,o,d,v;if((null==m?void 0:m.data)&&!u&&a===(null===(r=null===(e=null==m?void 0:m.meta)||void 0===e?void 0:e.pagination)||void 0===r?void 0:r.page)){const e=[...s,...m.data];l(e);const r=null===(d=null===(o=null==m?void 0:m.meta)||void 0===o?void 0:o.pagination)||void 0===d?void 0:d.count;i!==r&&"number"==typeof r&&c(r),(null===(v=null==m?void 0:m.links)||void 0===v?void 0:v.next)&&e.length<t&&n(a+1)}}),[m,a,t]),(0,r.useEffect)((()=>{var e;(null===(e=null==m?void 0:m.links)||void 0===e?void 0:e.next)&&s.length<t&&n(a+1)}),[t]),{samples:s,total:i,loading:d,error:v}})(e,t),l=n.filter((e=>!!(e.attributes&&"longitude"in e.attributes&&"latitude"in e.attributes)&&0!==e.attributes.longitude&&0!==e.attributes.latitude));return r.createElement("div",{className:"mg-map-container"},r.createElement("div",{className:"mg-map-wrapper"},r.createElement(u.Wrapper,{apiKey:b.SC,render:h},r.createElement(g,{data:l}))),s&&r.createElement("div",{className:"mg-map-progress"},r.createElement("progress",{max:s,value:n.length}),s>t&&r.createElement("div",null,"⚠️ We are only loading the first ",200," samples. Click"," ",r.createElement("button",{type:"button",className:"vf-button vf-button--link mg-button-as-link",onClick:()=>a(s)},"HERE")," ","to load them all."),0===l.length&&r.createElement("div",null,"⚠️ None of the ",s>t?"loaded":""," samples have geolocation co-ordinates.")))};var _=a(5058);const y=({data:e})=>{var t;const a=e.relationships.biomes.data[0].id;return r.createElement("section",null,r.createElement("div",{className:"vf-grid"},r.createElement("div",null,r.createElement("h4",null,"Last updated:"," ",new Date(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t["last-update"]).toDateString()),r.createElement("div",{className:"vf-box vf-box--easy vf-box-theme--primary"},r.createElement("h5",{className:"vf-box__heading"},"Classification"),r.createElement("p",{className:"vf-box__text"},r.createElement("span",{className:`biome_icon icon_sm ${(0,_.G)(a)}`,style:{float:"initial"}}),a)),r.createElement("div",{className:"vf-box vf-box--easy vf-box-theme--primary"},r.createElement("h5",{className:"vf-box__heading"},"Description"),r.createElement("p",{className:"vf-box__text"},e.attributes["study-abstract"]))),r.createElement(E,{study:e.id})),r.createElement("div",{className:"vf-box vf-box--easy vf-box-theme--primary"},r.createElement("h5",{className:"vf-box__heading"},"Related studies"),r.createElement("p",{className:"vf-box__text"})))},w=[{label:"Overview",to:"/overview"},{label:"Analysis summary",to:"/analysis"}],x=()=>{const e=(()=>{const e=(0,s.TH)().pathname.split("/");return null==e?void 0:e[e.length-1]})(),{data:t,loading:a,error:m}=(0,o.Z)(`studies/${e}`,{include:"publications"});if(a)return r.createElement(l.Z,{size:"large"});if(m)return r.createElement(i.Z,{error:m});if(!t)return r.createElement(l.Z,null);const u=t.data;return r.createElement("section",{className:"vf-content"},r.createElement("h2",null,"Study ",e),r.createElement("h3",null,u.attributes["study-name"]),r.createElement(n.UT,null,r.createElement(c,{tabs:w}),r.createElement("section",{className:"vf-grid"},r.createElement("div",{className:"vf-stack vf-stack--200"},r.createElement(s.rs,null,r.createElement(s.AW,{path:"/overview"},r.createElement(y,{data:u})),r.createElement(s.AW,{path:"/analysis"},r.createElement("div",null,"analysis")))))))}},5058:(e,t,a)=>{"use strict";a.d(t,{G:()=>i});const r={"root:engineered":"engineered_b"},n={"root:engineered:wastewater":"wastewater_b","root:environmental:air":"air_b","root:host-associated:amphibia":"amphibian_b","root:host-associated:arthropoda":"arthropoda_b","root:host-associated:fish":"fish_b","root:host-associated:human":"human_host_b","root:host-associated:insecta":"insect_b","root:host-associated:mammals":"mammals_b","root:host-associated:mollusca":"mollusca_b","root:host-associated:plants":"plant_host_b","root:host-associated:porifera":"porifera_b"},s={"root:environmental:aquatic:freshwater":"freshwater_b","root:environmental:aquatic:marine":"marine_b","root:environmental:aquatic:thermal springs":"hotspring_b","root:environmental:terrestrial:soil":"soil_b","root:environmental:terrestrial:volcanic":"vulcano_b","root:host-associated:human:digestive system":"human_gut_b","root:host-associated:human:skin":"skin_b"},o={"root:environmental:aquatic:freshwater:drinking water":"drinking_water_b","root:environmental:aquatic:freshwater:groundwater":"groundwater_b","root:environmental:aquatic:freshwater:ice":"ice_b","root:environmental:aquatic:freshwater:lake":"lake_b","root:environmental:aquatic:freshwater:lotic":"river_b","root:environmental:aquatic:marine:hydrothermal vents":"hydrothermal_vents_b","root:environmental:terrestrial:soil:wetlands":"wetlands_b","root:host-associated:human:digestive system:oral":"mouth_b","root:host-associated:human:respiratory system:pulmonary system":"lung_b","root:host-associated:mammals:nervous system:brain":"brain_b"},l={"root:environmental:aquatic:freshwater:groundwater:cave water":"cave_b","root:environmental:aquatic:freshwater:ice:glacier":"glacier_b","root:environmental:terrestrial:soil:grasslands":"grassland_b","root:environmental:terrestrial:soil:loam:forest soil":"forest_b","root:environmental:terrestrial:soil:sand:desert":"desert_b"};function i(e){const t=(e||"").split(":").map((e=>e.toLowerCase())),a=t.slice(0,2).join(":"),i=t.slice(0,3).join(":"),c=t.slice(0,4).join(":"),m=t.slice(0,5).join(":"),u=t.slice(0,6).join(":");return l[u]||o[m]||s[c]||n[i]||r[a]||"default_b"}}}]);
//# sourceMappingURL=671.ef2619b7.chunk.js.map