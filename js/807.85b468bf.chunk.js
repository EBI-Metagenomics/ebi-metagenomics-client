"use strict";(self.webpackChunkmgportalv2=self.webpackChunkmgportalv2||[]).push([[807],{2379:(e,t,a)=>{a.d(t,{Z:()=>i});var n=a(7294),l=a(2531);const r={biosynthetic:"Core biosynthetic gene","biosynthetic-additional":"Additional biosynthetic gene",regulatory:"Regulatory genes",transport:"Transport-related gene",resistance:"Resistance genes"},o=({value:e,url:t,decodeValue:a})=>{if(!e)return null;const r=e.split(",");return n.createElement("ul",{className:"vf-list"},r.map((e=>{const r=a?decodeURIComponent(e):e;return n.createElement("li",{key:e,className:"igv-popup-multiple-field-item"},t?n.createElement(l.Z,{href:`${t}${e}`},r):r)})))},s=e=>{const t="string"==typeof e.start?parseInt(e.start,10):e.start,a="string"==typeof e.end?parseInt(e.end,10):e.end;if(!Number.isNaN(t)&&!Number.isNaN(a)&&null!==t&&null!==a)return Math.ceil((a-t)/3)},i=({data:e})=>{const{name:t,gene:a,product:i,properties:c}=(e=>{const t=e.reduce(((e,t)=>(t.name&&(e[t.name.toLowerCase()]=t.value),e)),{}),a={title:"Functional annotation",data:[{name:"E.C Number",Value:t.ecnumber&&(()=>n.createElement(o,{value:t.ecnumber,url:"https://enzyme.expasy.org/EC/"}))},{name:"Pfam",Value:t.pfam&&(()=>n.createElement(o,{value:t.pfam,url:"https://pfam.xfam.org/family/"}))},{name:"KEGG",Value:t.kegg&&(()=>n.createElement(o,{value:t.kegg,url:"https://www.genome.jp/dbget-bin/www_bget?"}))},{name:"eggNOG",Value:t.eggnog&&decodeURIComponent(t.eggnog)},{name:"COG",Value:t.cog&&(()=>n.createElement(o,{value:t.cog}))},{name:"GO",Value:t.go&&(()=>n.createElement(o,{value:t.go,url:"https://www.ebi.ac.uk/ols/search?q="}))},{name:"InterPro",Value:t.interpro&&(()=>n.createElement(o,{value:t.interpro,url:"https://www.ebi.ac.uk/interpro/entry/InterPro/'"}))},{name:"Gene type",Value:t.as_type&&(r[t.as_type]||t.as_type)},{name:"Notes",Value:t.as_notes&&(()=>n.createElement(o,{value:decodeURIComponent(t.as_notes)}))},{name:"Cluster",Value:t.as_gene_clusters&&(()=>n.createElement(o,{value:t.as_gene_clusters}))}]},i={title:"Feature details",data:[{name:"Type",Value:t.type},{name:"Inference",Value:t.inference},{name:"Start / End",Value:`${t.start}/${t.end}`},{name:"Protein length",Value:String(s(t))}]},c={title:"Metaproteomics",data:[{name:"Peptide sequences",Value:t.peptide_sequences&&(()=>n.createElement(o,{value:t.peptide_sequences,decodeValue:!0}))},{name:"Pride ID",Value:t.pride_id&&(()=>n.createElement(l.Z,{href:`https://www.ebi.ac.uk/pride/archive/projects/${t.pride_id}`},t.pride_id))}]};return{name:t.id,gene:t.gene,product:t.product,properties:[a,i,c]}})(e);return n.createElement(n.Fragment,null,n.createElement("table",{className:"stack hover igv-popover-table"},n.createElement("caption",{className:"igv-popover-section-header"},"Feature"),n.createElement("tbody",null,t&&n.createElement("tr",null,n.createElement("td",{className:"igv-popover-table-td-name"},"ID"),n.createElement("td",null,t)),a&&n.createElement("tr",null,n.createElement("td",{className:"igv-popover-table-td-name"},"Gene"),n.createElement("td",null,n.createElement("em",null,a))),i&&n.createElement("tr",null,n.createElement("td",{className:"igv-popover-table-td-name"},"Product"),n.createElement("td",null,i)))),c.map((e=>n.createElement("table",{className:"stack hover igv-popover-table",key:e.title},e.data.filter((e=>!!e.Value)).length>0&&n.createElement("caption",{className:"igv-popover-section-header"},e.title),n.createElement("tbody",null,e.data.map((({name:e,Value:t})=>t&&n.createElement("tr",{key:e},n.createElement("td",{className:"igv-popover-table-td-name"},e),n.createElement("td",null,"string"==typeof t?t:n.createElement(t,null))))).filter(Boolean))))))}},2069:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(7294);const l=()=>n.createElement("svg",{"aria-hidden":"true",className:"vf-card__heading__icon | vf-icon vf-icon-arrow--inline-end",width:"1em",height:"1em",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",preserveAspectRatio:"none"},n.createElement("path",{d:"M0 12c0 6.627 5.373 12 12 12s12-5.373 12-12S18.627 0 12 0C5.376.008.008 5.376 0 12zm13.707-5.209l4.5 4.5a1 1 0 010 1.414l-4.5 4.5a1 1 0 01-1.414-1.414l2.366-2.367a.25.25 0 00-.177-.424H6a1 1 0 010-2h8.482a.25.25 0 00.177-.427l-2.366-2.368a1 1 0 011.414-1.414z",fill:"currentColor",fillRule:"nonzero"}))},32:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(7294),l=a(3253),r=a.n(l);r().setAppElement("#root");const o={overlay:{zIndex:1e4,position:"fixed"},content:{top:"50%",left:"50%",right:"auto",bottom:"auto",marginRight:"-50%",transform:"translate(-50%, -50%)",maxHeight:"calc(100vh - 5em)",overflowY:"auto"}},s=({isOpen:e,onRequestClose:t,contentLabel:a,children:l})=>n.createElement(r(),{isOpen:e,onRequestClose:t,contentLabel:a,style:o},n.createElement("div",{className:"emg-modal-close"},n.createElement("button",{onClick:t,className:"vf-button vf-button--link",type:"button"},n.createElement("i",{className:"icon icon-common icon-times"}))),l)},2750:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(7294);const l=({onChange:e,accept:t})=>{const a=(0,n.useRef)(null);return n.createElement(n.Fragment,null,n.createElement("input",{type:"file",hidden:!0,ref:a,onChange:e,accept:t}),n.createElement("button",{className:"vf-button vf-button--primary vf-button--sm",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.click()},type:"button"},"Browse for file..."))}},9980:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(7294);const l=({type:e,title:t,children:a})=>n.createElement("div",{className:"vf-banner vf-banner--alert "+(["warning","error"].includes(e)?"vf-banner--warning":"vf-banner--info")},(t||e)&&n.createElement("h3",{className:"vf-box__heading"},"info"===e&&n.createElement("span",{className:"icon icon-common icon-info"}),"error"===e&&n.createElement("span",{className:"icon icon-common icon-bolt"}),"warning"===e&&n.createElement("span",{className:"icon icon-common icon-exclamation-triangle"})," ",t||""),n.createElement("div",{className:"vf-banner__content"},a))},3415:(e,t,a)=>{a.d(t,{Z:()=>l});var n=a(7294);const l=({list:e})=>n.createElement("div",{className:"vf-grid vf-grid__col-2",style:{gridTemplateColumns:"1fr 2fr",rowGap:"0.5rem"}},e.map((({key:e,value:t})=>n.createElement(n.Fragment,{key:e},n.createElement("div",{style:{textAlign:"right"}},e,":"),n.createElement("div",null,"string"==typeof t?t:n.createElement(t,null))))))},7565:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294),l=a(7275);a(3751);const r=({content:e,children:t})=>n.createElement(l.ZP,{content:e},t)},9687:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$e});var n=a(7294),l=a(8110),r=a(964),o=a(402),s=a(1699),i=a(4821),c=a(3415),u=a(9711);const m=n.createContext({overviewData:null}),d=()=>{var e,t,a,l,r,o,s,i,d,g,p,h,b;const{overviewData:v}=(0,n.useContext)(m);return n.createElement("section",null,n.createElement("div",{className:"vf-stack"},n.createElement("details",{open:!0},n.createElement("summary",null,n.createElement("b",null,"Description")),n.createElement(c.Z,{list:[{key:"Study",value:(null===(a=null===(t=null===(e=v.relationships)||void 0===e?void 0:e.study)||void 0===t?void 0:t.data)||void 0===a?void 0:a.id)&&(()=>n.createElement(u.rU,{to:`/studies/${v.relationships.study.data.id}`},v.relationships.study.data.id))},{key:"Sample",value:(null===(o=null===(r=null===(l=v.relationships)||void 0===l?void 0:l.sample)||void 0===r?void 0:r.data)||void 0===o?void 0:o.id)&&(()=>n.createElement(u.rU,{to:`/samples/${v.relationships.sample.data.id}`},v.relationships.sample.data.id))},{key:"Assembly",value:(null===(d=null===(i=null===(s=v.relationships)||void 0===s?void 0:s.assembly)||void 0===i?void 0:i.data)||void 0===d?void 0:d.id)&&(f=v.attributes["experiment-type"],["assembly","hybrid_assembly","long_reads_assembly"].includes(f))&&(()=>n.createElement(u.rU,{to:`/assemblies/${v.relationships.assembly.data.id}`},v.relationships.assembly.data.id))},{key:"Run",value:(null===(h=null===(p=null===(g=v.relationships)||void 0===g?void 0:g.run)||void 0===p?void 0:p.data)||void 0===h?void 0:h.id)&&(()=>n.createElement(u.rU,{to:`/runs/${v.relationships.run.data.id}`},v.relationships.run.data.id))},{key:"Pipeline version",value:(null===(b=v.attributes)||void 0===b?void 0:b["pipeline-version"])&&(()=>n.createElement(u.rU,{to:`/pipelines/${v.attributes["pipeline-version"]}`},v.attributes["pipeline-version"]))}].filter((({value:e})=>!!e))})),n.createElement("details",{open:!0},n.createElement("summary",null,n.createElement("b",null,"Experiment details")),n.createElement(c.Z,{list:[{key:"Experiment type",value:v.attributes["experiment-type"]},{key:"Instrument model",value:v.attributes["instrument-model"]},{key:"Instrument platform",value:v.attributes["instrument-platform"]}].filter((({value:e})=>!!e))}))));var f};var g=a(7838),p=a(8840),h=a(5708),b=a.n(h);const v=({summaryData:e})=>{var t;const{overviewData:a}=(0,n.useContext)(m),l=(0,n.useRef)(null),r="assembly"===a.attributes["experiment-type"],o=r?"contigs":"reads",s=r?"Contigs":"Reads",i=[0,0,0,0,0],c=[0,0,0,0,0],u=[0,0,0,0,0],d={};((null===(t=a.attributes)||void 0===t?void 0:t["analysis-summary"])||[]).forEach((({key:e,value:t})=>{d[e]=t})),u[4]=Number(e.sequence_count),i[0]=Number(d["Submitted nucleotide sequences"]),i[1]=Number(d["Nucleotide sequences after format-specific filtering"]),i[2]=Number(d["Nucleotide sequences after length filtering"]),i[3]=Number(d["Nucleotide sequences after undetermined bases filtering"]),c[2]=i[1]-i[2],c[1]=i[0]-i[1],c[4]=i[3]-i[4]-u[4];const g={chart:{type:"bar",height:240},title:{text:`Number of sequence ${o} per QC step`},yAxis:{min:0,title:{text:"Count"}},xAxis:{categories:[`Initial ${o}`,"Trimming","Length filtering","Ambiguous base filtering",`${s} subsampled for QC analysis`]},plotOptions:{series:{stacking:"normal"}},credits:{enabled:!1},series:[{name:`${s} filtered out`,data:c,color:"#CCCCD3"},{name:`${s} remaining`,data:i,color:"#058DC7"},{name:`${s} after sampling`,data:u,color:"#8dc7c7"}]};return n.createElement(b(),{highcharts:p,options:g,ref:l})},f=({summaryData:e})=>{const{overviewData:t}=(0,n.useContext)(m),a=(0,n.useRef)(null),i=(0,r.Z)(),{data:c,loading:u,error:d}=(0,l.Z)(`analyses/${i}/seq-length`,{},{},g.B5.TSV);if(u)return n.createElement(o.Z,{size:"large"});if(d)return n.createElement(s.Z,{error:d});if(!c)return n.createElement(o.Z,null);const h=c.map((([e,t])=>[Number(e),Number(t)])),v=Math.max(...h.map((([e])=>e))),f="assembly"===t.attributes["experiment-type"],y=f?"Contigs":"Reads",E={chart:{marginLeft:78,style:{fontFamily:"Helvetica"},zoomType:"x"},title:{text:`${y} length histogram`,style:{fontSize:16,fontWeight:"bold"}},yAxis:{title:{text:"Number of "+(f?"contigs":"reads")}},xAxis:{min:0,max:100*(Math.floor(v/100)+1),plotBands:null===e?[]:[{from:Number(e.average_length)-Number(e.standard_deviation_length),to:Number(e.average_length)+Number(e.standard_deviation_length),color:"rgba(128, 128, 128, .2)",label:{text:`Standard Deviation<br/>±${Number(e.standard_deviation_length).toFixed(2)}`,style:{color:"#666666",fontSize:"0.8em"}}}]},series:[{name:y,data:h,color:"#058dc7"}],legend:{enabled:!1},credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}}};return n.createElement(b(),{highcharts:p,options:E,ref:a})},y=()=>{const e=(0,n.useRef)(null),t=(0,r.Z)(),{data:a,loading:i,error:c}=(0,l.Z)(`analyses/${t}/nucleotide-distribution`,{},{},g.B5.TSV);if(i)return n.createElement(o.Z,{size:"large"});if(c)return n.createElement(s.Z,{error:c});if(!a)return n.createElement(o.Z,null);const u={pos:[],A:[],G:[],T:[],C:[],N:[]},m={A:"rgb(16, 150, 24)",G:"rgb(255, 153, 0)",C:"rgb(51, 102, 204)",T:"rgb(220, 57, 18)",N:"rgb(138, 65, 23)"},d=a[0];a.slice(1).forEach((e=>{e.forEach(((e,t)=>{u[d[t]].push(Number(e))}))}));const h={chart:{type:"area",style:{fontFamily:"Helvetica"}},title:{text:"Nucleotide position histogram",style:{fontSize:16,fontWeight:"bold"}},xAxis:{categories:u.pos,tickmarkPlacement:"on",title:{enabled:!1}},yAxis:{min:0,max:100,title:{enabled:!1}},plotOptions:{area:{stacking:"normal",lineColor:"#666666",lineWidth:1,marker:{lineWidth:1,lineColor:"#666666"}}},tooltip:{shared:!0},series:["A","T","C","G","N"].map((e=>({name:e,data:u[e],color:m[e]}))),credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}}};return n.createElement(b(),{highcharts:p,options:h,ref:e})},E=({summaryData:e})=>{const{overviewData:t}=(0,n.useContext)(m),a=(0,n.useRef)(null),i=(0,r.Z)(),{data:c,loading:u,error:d}=(0,l.Z)(`analyses/${i}/gc-distribution`,{},{},g.B5.TSV);if(u)return n.createElement(o.Z,{size:"large"});if(d)return n.createElement(s.Z,{error:d});if(!c)return n.createElement(o.Z,null);const h=c.map((([e,t])=>[Number(e),Number(t)])),v="assembly"===t.attributes["experiment-type"],f=v?"Contigs":"Reads",y={chart:{style:{fontFamily:"Helvetica"},zoomType:"x"},title:{text:`${f} GC distribution`,style:{fontSize:16,fontWeight:"bold"}},yAxis:{title:{text:"Number of "+(v?"contigs":"reads")}},xAxis:{min:0,max:100,plotBands:null===e?[]:[{from:Number(e.average_gc_content)-Number(e.standard_deviation_gc_content),to:Number(e.average_gc_content)+Number(e.standard_deviation_gc_content),color:"rgba(128, 128, 128, .2)",borderColor:"#000000",label:{text:`Standard Deviation<br/>±${Number(e.standard_deviation_gc_content).toFixed(2)}`,style:{color:"#666666",fontSize:"0.8em"}}}]},series:[{name:f,data:h,color:"#058dc7"}],legend:{enabled:!1},credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}}};return n.createElement(b(),{highcharts:p,options:y,ref:a})},_=({summaryData:e})=>{const t=(0,n.useRef)(null),a={chart:{type:"bar",marginTop:0,height:120},title:!1,xAxis:{categories:["Minimum","Average","Maximum"],title:{enabled:!1},lineColor:"#595959",tickColor:""},yAxis:{min:0,max:100*(Math.floor(Number(e.length_max)/100)+1),title:{text:"Sequence length (bp)"},plotBands:[{from:Number(e.average_length)-Number(e.standard_deviation_length),to:e.average_length+Number(e.standard_deviation_length),color:"rgba(128, 128, 128, .2)"}]},plotOptions:{series:{grouping:!1,shadow:!1,borderWidth:0}},series:[{name:"Length",data:[{y:Number(e.length_min),x:0,color:"rgb(114, 191, 63)"},{y:Number(e.average_length),x:1,color:"rgb(63, 114, 191)"},{y:Number(e.length_max),x:2,color:"rgb(114, 63, 191)"}],pointPadding:-.2,tooltip:{pointFormatter(){return`<span style="color:${this.color}">●</span> ${this.category}: <b>${this.y.toFixed(2)}</b><br/>`}}}],legend:{enabled:!1},credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}},exporting:{enabled:!1}};return n.createElement(b(),{highcharts:p,options:a,ref:t})},w=({summaryData:e})=>{const t=(0,n.useRef)(null),a={chart:{type:"bar",marginTop:0,height:150},title:!1,xAxis:{categories:["Content"],title:{enabled:!1},lineColor:"#595959",tickColor:""},yAxis:{min:0,max:100,title:{enabled:!1},plotBands:[{from:Number(e.average_gc_content)-Number(e.standard_deviation_gc_content),to:Number(e.average_gc_content)+Number(e.standard_deviation_gc_content),color:"rgba(128, 128, 128, .2)"}]},plotOptions:{series:{grouping:!1,shadow:!1,borderWidth:0}},series:[{name:"GC content",pointPadding:.25,color:"rgb(63, 114, 191)",tooltip:{pointFormatter(){return`<span style="color:${this.color}">●</span> ${this.series.name}: <b>${this.y.toFixed(2)}%</b><br/>`}},data:[Number(e.average_gc_content)]},{name:"AT content",color:"rgb(114, 63, 191)",pointPadding:.25,threshold:Number(e.average_gc_content),tooltip:{pointFormatter(){const t=(100-Number(e.average_gc_content)).toFixed(2);return`\n              <span style="color:${this.color}">●</span>\n              ${this.series.name}: <b>${t}%</b>\n              <br/>`}},data:[100]}],credits:!1,navigation:{buttonOptions:{height:32,width:32,symbolX:16,symbolY:16,y:-10}},exporting:{enabled:!1}};return n.createElement(b(),{highcharts:p,options:a,ref:t})},N=()=>{const{overviewData:e}=(0,n.useContext)(m),t=e.id,{data:a,loading:r,error:i}=(0,l.Z)(`analyses/${t}/summary`,{},{},g.B5.TSV);if(r)return n.createElement(o.Z,{size:"large"});if(i)return n.createElement(s.Z,{error:i});if(!a)return n.createElement(o.Z,null);const c=Object.fromEntries(a),u="assembly"===e.attributes["experiment-type"],d=u?"contig":"read",p=u?"contigs":"reads";return n.createElement("div",{className:"vf-stack vf-stack--200"},n.createElement("p",null,"The chart below shows the number of ",p," which pass the quality control steps in the pipeline. Paired-end sequences may have been merged, in which case the initial number of ",p," may differ from the number given by ENA."),n.createElement(v,{summaryData:c}),Number(e.attributes["pipeline-version"])>2&&n.createElement(n.Fragment,null,n.createElement("p",null,"The histograms below show the distributions of sequence lengths (left) and percentage GC content (right) for the sequences having passed quality control. Note that for large files, the distributions were compiled from a random subset of 2 million",p,". The standard deviations are shown on each plot. The bar chart underneath each graph indicates the minimum, mean and maximum length and mean GC and AT content, respectively."),n.createElement("div",{className:"vf-grid vf-grid__col-2"},n.createElement("div",{className:"vf-stack"},n.createElement(f,{summaryData:c}),n.createElement(_,{summaryData:c})),n.createElement("div",{className:"vf-stack"},n.createElement(E,{summaryData:c}),n.createElement(w,{summaryData:c}))),n.createElement("p",null,'The graph below show the relative abundance of nucletotides (A, C, G, T, or ambiguous base "N") at each position starting from the beginning of each ',d," up to the first 500 base pairs."),n.createElement(y,null)))};var x=a(6050),C=a(4897),k=a.n(C),Z=a(8696),P=a(7565),S=a(2054);const D=n.createContext({contigsQueryData:{data:null,loading:!1,error:null},queryParameters:{},setQueryParameters:S.Z});var $=a(2069);const O=e=>e.split("cursor=")[1].split("&")[0],F=({paginationLinks:e,handleCursor:t})=>{const a=!!e.prev,l=!!e.next;return n.createElement("section",{className:"mg-table-footer"},n.createElement("nav",{className:"vf-pagination","aria-label":"Pagination"},n.createElement("ul",{className:"vf-pagination__list"},n.createElement("li",{className:"vf-pagination__item vf-pagination__item--previous-page"},n.createElement("button",{disabled:!a,type:"button",onClick:()=>t(O(e.prev)),className:"vf-button vf-button--link vf-pagination__link"},"Previous",n.createElement("span",{className:"vf-u-sr-only"}," page"))),n.createElement("li",{className:"vf-pagination__item vf-pagination__item--next-page"},n.createElement("button",{disabled:!l,type:"button",onClick:()=>t(O(e.next)),className:"vf-button vf-button--link vf-pagination__link"},"Next",n.createElement("span",{className:"vf-u-sr-only"}," page"))))))},T=({annotationType:e,present:t})=>{let a;const l=e[0].toUpperCase();switch(e){case"cog":a="#3b6fb6";break;case"kegg":a="#18974c";break;case"pfam":a="#193f90";break;case"interpro":a="#734595";break;case"go":a="#f49e17";break;case"antismash":a="#b65417";break;default:a="#8d8f8e"}t||(a+="55");const r=`${t?"Has":"Does’t have"} ${e} annotations`;return n.createElement(P.Z,{content:r},n.createElement("div",{className:"emg-contig-feature-flag vf-text vf-text-body--4",style:{borderColor:a,color:a}},l))},A=()=>{const{contigsQueryData:e,setQueryParameters:t,queryParameters:a}=(0,n.useContext)(D),{data:l,loading:r,error:i}=e||{},c=(0,n.useMemo)((()=>[{id:"contig_id",Header:"Name",accessor:e=>e.attributes["contig-id"],Cell:({cell:e})=>n.createElement("button",{className:"vf-button vf-button--link vf-button--sm contig-id-button",type:"button",onClick:()=>t(Object.assign(Object.assign({},a),{selectedContig:e.value}))},e.value,n.createElement($.Z,null))},{id:"length",Header:"Length (bp)",accessor:e=>e.attributes.length,Cell:({cell:e})=>n.createElement("span",null,e.value)},{id:"coverage",Header:"Coverage",accessor:e=>e.attributes.coverage,Cell:({cell:e})=>n.createElement("span",null,e.value)},{id:"features",Header:"Features",accessor:e=>e.attributes,Cell:({cell:e})=>{const t=Object.entries(e.value).filter((([e])=>e.startsWith("has-"))).map((([e,t])=>n.createElement(T,{key:e,annotationType:e.substring(4),present:!!t})));return n.createElement("div",{className:"emg-contig-feature-flags"},t)}}]),[a,t]);return r&&!l?n.createElement(o.Z,{size:"large"}):i||!l?n.createElement(s.Z,{error:i}):n.createElement("div",null,n.createElement(Z.Z,{cols:c,data:l,showPagination:!1,title:()=>n.createElement(n.Fragment,null,"Assembly Contigs",n.createElement("span",{className:"mg-number"},l.meta.pagination.count)),initialPage:0,className:"mg-contigs-table",namespace:"contigs_",loading:r}),n.createElement(F,{paginationLinks:l.links,handleCursor:e=>t(Object.assign(Object.assign({},a),{contigsPageCursor:e}))}))};var B=a(2119),R=a(7927),G=a(4063);class I extends G.default{constructor(){super("emgGFF"),this.version(1).stores({gffs:"++id, name"})}}const q=new I;var V=a(1039),z=a(9521);const M=({cols:e,data:t,className:a="",sortable:l=!1,loading:r=!1,isStale:s=!1})=>{const{getTableProps:i,getTableBodyProps:c,headerGroups:u,rows:m,prepareRow:d}=(0,z.useTable)({columns:e,data:t},z.useSortBy),g=(0,n.useRef)(null);return r&&!s?n.createElement(o.Z,{size:"small"}):n.createElement("section",null,n.createElement("div",{className:"mg-table-overlay-container"},n.createElement("div",{className:r&&s?"mg-table-overlay":void 0}),n.createElement("table",Object.assign({},i,{className:`vf-table--striped mg-table ${a}`,ref:g}),n.createElement("thead",{className:"vf-table__header"},u.map((e=>n.createElement("tr",Object.assign({},e.getHeaderGroupProps(),{className:"vf-table__row"}),e.headers.map((e=>n.createElement("th",Object.assign({},l&&e.canSort?e.getHeaderProps(e.getSortByToggleProps()):{key:e.id},{className:"vf-table__heading"}),e.render("Header"),l&&e.canSort&&n.createElement(n.Fragment,null," ",n.createElement("span",null,e.isSorted?e.isSortedDesc?n.createElement("i",{className:"icon icon-common icon-sort-down"}):n.createElement("i",{className:"icon icon-common icon-sort-up"}):n.createElement("i",{className:"icon icon-common icon-sort"})))))))))),n.createElement("tbody",Object.assign({},c(),{className:"vf-table__body"}),m.map((e=>(d(e),n.createElement("tr",Object.assign({},e.getRowProps(),{className:"vf-table__row"}),e.cells.map((e=>n.createElement("td",Object.assign({},e.getCellProps(),{className:"vf-table__cell"}),e.render("Cell"))))))))))))};var j=a(2750),L=a(32),H=function(e,t,a,n){return new(a||(a=Promise))((function(l,r){function o(e){try{i(n.next(e))}catch(e){r(e)}}function s(e){try{i(n.throw(e))}catch(e){r(e)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,s)}i((n=n.apply(e,t||[])).next())}))};const U=({igvBrowser:e})=>{const[t,a]=(0,n.useState)(!1),[l,r]=(0,n.useState)(null),[o,s]=(0,B.B)({gffComparisonId:null},{gffComparisonId:Number}),{setQueryParameters:i,queryParameters:c}=(0,n.useContext)(D),u=(0,V.useLiveQuery)((()=>q.gffs.toArray()));(0,n.useEffect)((()=>{o.gffComparisonId&&q.gffs.get(o.gffComparisonId).then((t=>{void 0===t?s({gffComparisonId:null}):(e.removeTrackByName(t.name),e.loadTrack({name:t.name,type:"annotation",url:`data:application/octet-stream;base64,${t.encodedGFF}`,format:"gff3",filterTypes:[],removable:!1}))}))}),[o,e,s]);const m=(0,n.useMemo)((()=>[{id:"name",Header:"GFF Filename",accessor:e=>e.name,Cell:({cell:e,row:t})=>n.createElement("button",{className:"vf-button vf-button--link vf-button--sm contig-id-button",type:"button",onClick:()=>H(void 0,void 0,void 0,(function*(){const e=yield q.gffs.get(t.original.id);i(Object.assign(Object.assign({},c),{gffComparisonId:e.id})),a(!1)}))},e.value,n.createElement($.Z,null))},{id:"size",Header:"File size (Kb)",accessor:e=>e.size,Cell:({cell:e})=>n.createElement("span",null,e.value)},{id:"added",Header:"Added",accessor:e=>e.added,Cell:({cell:e})=>{var t;return n.createElement("span",null,null===(t=e.value)||void 0===t?void 0:t.toLocaleString())}},{id:"del",Header:"Remove",accessor:e=>e.id,Cell:({cell:e})=>n.createElement("button",{className:"vf-button vf-button--link vf-button--sm",type:"button",onClick:()=>q.gffs.delete(e.value)},"Remove")}]),[o,s]);function d(e){return H(this,void 0,void 0,(function*(){if(!e)return;const t=yield function(e){return t=this,a=void 0,l=function*(){return new Promise((t=>{const a=new FileReader;a.onload=()=>{const e=a.result;t(btoa(e))},a.readAsText(e)}))},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{i(l.next(e))}catch(e){r(e)}}function s(e){try{i(l.throw(e))}catch(e){r(e)}}function i(t){var a;t.done?e(t.value):(a=t.value,a instanceof n?a:new n((function(e){e(a)}))).then(o,s)}i((l=l.apply(t,a||[])).next())}));var t,a,n,l}(e);try{yield q.gffs.add({name:e.name,size:e.size,added:new Date(Date.now()),encodedGFF:t}),r(null)}catch(e){r(`GFF upload error: ${e}`)}}))}return n.createElement("div",null,n.createElement(L.Z,{isOpen:t,onRequestClose:()=>a(!1),contentLabel:"Example Modal"},n.createElement("div",{className:"vf-stack vf-stack--800"},n.createElement("h1",null,"Compare a GFF to the contig"),n.createElement("form",{className:"vf-stack vf-stack--400",action:"#",method:"get"},n.createElement("div",{className:"vf-form__item vf-stack"},n.createElement("label",{htmlFor:"upload-picker",className:"vf-form__label vf-form__label--required"},n.createElement("h2",null,"Upload a GFF file from your computer")),n.createElement("p",{className:"vf-form__helper"},"The GFF will be stored in your browser, not sent to MGnify servers."),n.createElement(j.Z,{onChange:e=>d(e.target.files[0]),accept:".gff,.gff3"}),l&&n.createElement("p",{className:"vf-form__helper vf-form__helper--error"},l))),n.createElement("div",{className:"vf-stack vf-stack--200"},n.createElement("h2",null,"Previously uploaded GFFs"),n.createElement("p",{className:"vf-form__helper"},"Click the GFF’s name to view it in the browser"),n.createElement(M,{cols:m,data:u})))),n.createElement("button",{className:"vf-button vf-button--secondary vf-button--sm",type:"button",onClick:()=>a(!0)},"Load a GFF"))};var W=a(7762),Q=a(2379);const K=({contig:e})=>{const t=(0,r.Z)(),{config:a}=(0,n.useContext)(x.Z),l=e.attributes["contig-id"],i=`${a.api}analyses/${e.attributes.accession}/contigs/${l}`,{data:c,loading:u,error:m}=(0,g.ZP)(i,g.B5.TXT),d=e.attributes["has-antismash"],p=e.attributes["contig-name"],[h,b]=(0,n.useState)(null),v=(0,n.useCallback)((e=>{const r={showChromosomeWidget:!1,showTrackLabelButton:!0,showTrackLabels:!0,showCenterGuide:!1,reference:{indexed:!1,fastaURL:i},tracks:[{name:p,type:"mgnify-annotation",format:"gff3",url:`${a.api}analyses/${t}/contigs/${l}/annotations`,displayMode:"EXPANDED",label:"Functional annotation",colorAttributes:[["Default",""],["COG","COG"],["GO","GO"],["KEGG","KEGG"],["Pfam","Pfam"],["InterPro","InterPro"]],colorBy:void 0,defaultColour:void 0,labelBy:void 0}],showLegend:!0,legendParent:"#contig"};d&&r.tracks.push({colorAttributes:[],name:void 0,type:"mgnify-annotation",format:"gff3",displayMode:"EXPANDED",url:`${a.api}analyses/${t}/contigs/${l}/annotations?antismash=True`,label:"antiSMASH",colorBy:"as_type",defaultColour:"#BEBEBE",labelBy:"as_gene_clusters"}),null!==e&&k().createBrowser(e,r).then((e=>{e.on("trackclick",((e,t)=>W.renderToString(n.createElement(Q.Z,{data:t})))),b(e)}))}),[i,p,a.api,t,l,d]);return u?n.createElement(o.Z,{size:"small"}):m?n.createElement(s.Z,{error:m}):c?n.createElement("div",{id:"contig"},n.createElement("div",{ref:v}),n.createElement(U,{igvBrowser:h})):n.createElement(o.Z,null)},X=()=>{const e=(0,r.Z)(),[t,a]=(0,B.B)({contigsPageCursor:"",selectedContig:"",gffComparisonId:""}),{data:i,loading:c,error:u}=(0,l.Z)(`analyses/${e}/contigs`,{cursor:t.contigsPageCursor},{}),m=(0,n.useMemo)((()=>({contigsQueryData:{data:i,loading:c,error:u},queryParameters:t,setQueryParameters:a})),[i,u,c,t,a]),d=(0,n.useMemo)((()=>{var e,a,n;let l;if(!i)return null;const r=t.selectedContig||(null===(n=null===(a=null===(e=i.data)||void 0===e?void 0:e[0])||void 0===a?void 0:a.attributes)||void 0===n?void 0:n["contig-id"]);return r&&(l=(0,R.Z)(i.data,(e=>e.attributes["contig-id"]===r)),l)?l:null}),[i,t]);return(0,n.useEffect)((()=>{d&&d.attributes["contig-id"]!==t.selectedContig&&a(Object.assign(Object.assign({},t),{selectedContig:d.attributes["contig-id"]}))})),(0,n.useEffect)((()=>{if(t.selectedContig&&i&&!d){const{selectedContig:e}=t,n=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(a[n[l]]=e[n[l]])}return a}(t,["selectedContig"]);a(n)}}),[i,d,t,a]),c?n.createElement(o.Z,{size:"large"}):u?n.createElement(s.Z,{error:u}):i&&d?n.createElement("div",{className:"vf-stack vf-stack--800"},n.createElement(D.Provider,{value:m},n.createElement("section",null,n.createElement("div",{className:"vf-stack"},n.createElement("details",{open:!0},n.createElement("summary",null,n.createElement("b",null,"Contig browser")),n.createElement(K,{contig:d})))),n.createElement("section",null,n.createElement(A,null)))):n.createElement(o.Z,null)},Y=({tabs:e,queryParameter:t,defaultValue:a})=>{const[l,r]=(0,B.B)({[t]:""});(0,n.useEffect)((()=>{""===l[t]&&r(Object.assign(Object.assign({},l),{[t]:a}))}),[l,t]);const o=l[t];return n.createElement("div",{className:"vf-tabs mg-search-tabs"},n.createElement("ul",{className:"vf-tabs__list"},e.map((({label:e,to:a})=>n.createElement("li",{className:"vf-tabs__item",key:a},n.createElement("button",{type:"button",className:"vf-tabs__link mg-button-as-tab "+(a===o?"is-active":""),onClick:()=>r(Object.assign(Object.assign({},l),{[t]:a}))},"string"==typeof e?e:n.createElement(e,null)))))))};var J=a(5457);const ee=e=>(t,a)=>{switch(e){case"i":case"y":case"percentage":return Number(t[e])-Number(a[e]);case"-i":case"-y":case"-percentage":return Number(a[e.slice(1)])-Number(t[e.slice(1)]);case"name":return a.name>=t.name?-1:1;case"-name":return t.name>=a.name?-1:1;case"lineage":return a.lineage[0]>=t.lineage[0]?-1:1;case"-lineage":return t.lineage[0]>=a.lineage[0]?-1:1;default:return 0}},te=({clusteredData:e,onMouseEnterRow:t=(()=>null),onMouseLeaveRow:a=(()=>null)})=>{const[{order:l}]=(0,B.B)({order:""}),r=[{Header:"",accessor:"i"},{id:"name",Header:"Phylum",accessor:e=>e,Cell:({cell:e})=>n.createElement(n.Fragment,null,n.createElement("div",{style:{width:"1rem",height:"1rem",display:"inline-block",backgroundColor:e.value.color,verticalAlign:"sub"}}," ")," ",e.value.name)},{id:"lineage",Header:"Domain",accessor:"lineage[0]"},{Header:"Unique OTUs",accessor:"y"},{Header:"%",accessor:"percentage"}];return n.createElement(Z.Z,{cols:r,data:e.sort(ee(l)),initialPageSize:100,className:"mg-anlyses-table",showPagination:!1,onMouseEnterRow:t,onMouseLeaveRow:a,sortable:!0})};function ae(e){let t=0;return e.forEach((e=>{t+=e.y})),t}function ne(e,t){const a=[];let n=0;for(;n<t.length;)a.push(e[Math.min(n,e.length-1)]),n+=1;return a}const le=({clusteredData:e,title:t,selectedValue:a=null,showLegend:l=!1,showTotal:r=!1})=>{const o=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(o.current&&null!==a){const e=Math.min(a,o.current.chart.series[0].data.length-1);o.current.chart.series[0].data.forEach((e=>e.setState(""))),o.current.chart.series[0].data[e].setState("hover"),o.current.chart.tooltip.refresh(o.current.chart.series[0].data[e])}}),[a]);const s=function(e,t){const a=e.slice(0,10);if(e.length>10){const t={name:"Other",lineageA:[],lineage:[],y:0,i:11,color:"grey"};e.slice(10).forEach((e=>{t.y+=e.y,-1===t.lineageA.indexOf(e.lineage[0])&&t.lineageA.push(e.lineage[0])})),t.lineage=[t.lineageA.join(", ")],a.push(t)}return a}(e),i={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:t},tooltip:{pointFormat:"<b>{point.y}</b> {series.name} ({point.percentage:.2f}%)"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.2f} %",style:{color:"black"}},colors:ne(J.DC,s),showInLegend:l}},credits:{enabled:!1},series:[{name:"reads",colorByPoint:!0,data:s}]};return r&&(i.subtitle={text:`Total: ${ae(e)} reads`}),l&&(i.legend={title:{text:"Click to hide"},align:"right",verticalAlign:"middle",layout:"vertical",labelFormatter(){return this.name.length>15?`${this.name.slice(0,15)}...`:this.name}}),n.createElement(b(),{highcharts:p,options:i,ref:o})};function re(e){let t=0;return e.forEach((e=>{t+=e.y})),t}const oe=({clusteredData:e,title:t,selectedValue:a=null,showLegend:l=!1,showTotal:r=!1})=>{const o=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(o.current&&null!==a){const e=a;o.current.chart.series[0].data.forEach((e=>e.setState(""))),e<o.current.chart.series[0].data.length&&(o.current.chart.series[0].data[e].setState("hover"),o.current.chart.tooltip.refresh(o.current.chart.series[0].data[e]))}}),[a]);const s=e.slice(0,10),i=s.map((e=>e.name)),c=re(e),u={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"column"},title:{text:t},credits:{enabled:!1},series:[{colorByPoint:!0,data:s,colors:J.DC}],xAxis:{categories:i,title:{text:null}},yAxis:{min:0,title:{text:"Number of sequences",align:"high"},labels:{overflow:"justify"}},tooltip:{formatter(){const e=100*this.y/c;return`${this.x}<br/><b>${this.y}</b> reads (${e.toFixed(2)}%)`}},legend:{enabled:!1}};return r&&(u.subtitle={text:`Total: ${re(e)} reads`}),l&&(u.legend={title:{text:"Click to hide"},align:"right",verticalAlign:"middle",layout:"vertical",labelFormatter(){return this.name.length>15?`${this.name.slice(0,15)}...`:this.name}}),n.createElement(b(),{highcharts:p,options:u,ref:o})},se=({clusteredData:e,title:t,selectedValue:a=null,showLegend:l=!1})=>{const r=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(r.current&&null!==a){const e=a;r.current.chart.series[0].data.forEach((e=>e.setState(""))),e<r.current.chart.series.length&&(r.current.chart.series[e].data[0].setState("hover"),r.current.chart.tooltip.refresh(r.current.chart.series[e].data[0]))}}),[a]);const o=function(e){let t=0;const a=J.DC.length-1;return e.map((e=>({name:e.name,data:[e.y],color:J.DC[Math.min(t++,a)]})))}(e),s=function(e){let t=0;return e.forEach((e=>{t+=e.y})),t}(e),i={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"column"},title:{text:t},subtitle:{text:`Total: ${s} reads`},credits:{enabled:!1},tooltip:{formatter(){const e=100*this.y/s;return`${this.series.name}<br/><b>${this.y}</b> reads (${e.toFixed(2)}%)`}},plotOptions:{series:{stacking:"percent",dataLabels:{enabled:!0}}},yAxis:{min:0,max:100},xAxis:{title:{text:null,enabled:!1},labels:{enabled:!1}},legend:{enabled:!1},series:o};return l&&(i.legend={title:{text:"Click to hide"},align:"right",verticalAlign:"middle",layout:"vertical",labelFormatter(){return this.name.length>15?`${this.name.slice(0,15)}...`:this.name}}),n.createElement(b(),{highcharts:p,options:i,ref:r})};function ie(e,t=0){const a={};let n=0;return e.forEach((e=>{const l=e.attributes,r=String(l.lineage).split(":");let o;o=r.length<t?r[r.length-1]:r[t],t>0&&["","Bacteria","Eukaryota","other_sequences",void 0].includes(o)&&(o="Bacteria"===r[0]?"Unassigned Bacteria":"Unassigned"),"Unusigned"===r[0]&&1===r.length&&(o="Unassigned");const s=Number(l.count);n+=s,o in a?a[o].v+=s:a[o]={v:s,l:r}})),Object.entries(a).map((([e,{v:t,l:a}])=>({name:e,y:t,lineage:a}))).sort(((e,t)=>t.y-e.y)).map(((e,t)=>Object.assign(Object.assign({},e),{i:t+1,color:J.DC[Math.min(t,J.DC.length-1)],percentage:(100*e.y/n).toFixed(2)})))}const ce=({accession:e,category:t,chartType:a})=>{const{data:r,loading:i,error:c}=(0,l.Z)(`analyses/${e}/taxonomy${t}`),[u,m]=(0,n.useState)(null);if(i)return n.createElement(o.Z,null);if(c)return n.createElement(s.Z,{error:c});const d=ie(r.data,2),g=ie(r.data),p=["","/ssu","/lsu"].includes(t),h=g.findIndex((e=>e.name===(null==u?void 0:u.lineage)));return n.createElement("div",{className:"vf-stack"},n.createElement("div",{className:"vf-grid "+(p&&"stacked-column"!==a?"vf-grid__col-2 mg-grid-30-70":"")},"pie"===a&&p&&n.createElement(le,{clusteredData:g,selectedValue:h>=0?h:null,title:"Domain composition"}),"pie"===a&&n.createElement(le,{clusteredData:d,title:"Phylum composition",selectedValue:u?u.i-1:null,showTotal:!0,showLegend:!0}),"column"===a&&p&&n.createElement(oe,{clusteredData:g,selectedValue:h>=0?h:null,title:"Domain composition"}),"column"===a&&n.createElement(oe,{clusteredData:d,title:"Phylum composition (top 10)",selectedValue:u?u.i-1:null,showTotal:!0}),"stacked-column"===a&&n.createElement(se,{clusteredData:d,title:"Phylum composition (top 10)",selectedValue:u?u.i-1:null})),n.createElement("div",null,n.createElement(te,{clusteredData:d,onMouseEnterRow:e=>m(e.values),onMouseLeaveRow:()=>m(null)})))},ue=[{label:"Krona",to:"krona"},{label:"Pie",to:"pie"},{label:"Column",to:"column"},{label:"Stacked Column",to:"stacked-column"}],me="type",de="krona",ge=({accession:e})=>{const{data:t,loading:a,error:r}=(0,l.Z)(`analyses/${e}/taxonomy/overview`),[i]=(0,B.B)({[me]:de}),c=null==t?void 0:t.data,m=(null==c?void 0:c.taxonomy_ssu_count)>0||(null==c?void 0:c.taxonomy_count)>0,d=(null==c?void 0:c.taxonomy_lsu_count)>0,g=(null==c?void 0:c.taxonomy_itsonedb_count)>0,p=(null==c?void 0:c.taxonomy_itsunite_count)>0,h=!(null==c?void 0:c.taxonomy_ssu_count)&&(null==c?void 0:c.taxonomy_count)>0,{config:b}=(0,n.useContext)(x.Z),[v,f]=(0,n.useState)("");if((0,n.useEffect)((()=>{a||r||!t||f((g?"/itsonedb":p&&"/unite")||m&&h&&"/ssu"||d&&"/lsu"||"")}),[t,a,r,p,g,d,m,h]),a)return n.createElement(o.Z,{size:"large"});if(r)return n.createElement(s.Z,{error:r});const y=e=>{f(e.target.value)};return n.createElement("div",{className:"vf-stack"},n.createElement("div",null,(m||d)&&n.createElement("fieldset",{className:"vf-form__fieldset vf-stack vf-stack--400 mg-fieldbox",style:{width:"15rem"}},n.createElement("legend",{className:"vf-form__legend"},"rRNA"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"smallrRNA",name:"tax-results",value:"/ssu",checked:"/ssu"===v,onChange:y})," ","small subunit rRNA"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"largerRNA",name:"tax-results",value:"/lsu",checked:"/lsu"===v,onChange:y})," ","large subunit rRNA")),(g||p)&&n.createElement("fieldset",{className:"vf-form__fieldset vf-stack vf-stack--400 mg-fieldbox",style:{width:"15rem"}},n.createElement("legend",{className:"vf-form__legend"},"ITS"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"smallrRNA",name:"tax-results",value:"/itsonedb",checked:"/itsonedb"===v,onChange:y})," ","ITS with ITSoneDB"),n.createElement("label",null,n.createElement("input",{type:"radio",id:"largerRNA",name:"tax-results",value:"/unite",checked:"/unite"===v,onChange:y})," ","ITS1/2 with UNITE"))),n.createElement("div",null,"These are the results from the taxonomic analysis steps of our pipeline. You can switch between different views of the data using the menu of icons below (pie, bar, stacked and interactive krona charts). The data used to build these charts can be found under the"," ",n.createElement(u.rU,{to:"#download"},"Download")," tab."),n.createElement(Y,{tabs:ue,queryParameter:me,defaultValue:de}),n.createElement("div",{className:"vf-tabs-content"},"krona"===i.type?n.createElement("object",{className:"krona_chart",data:`${b.api}analyses/${e}/krona${v}?collapse=false`,type:"text/html",title:"Interactive Krona chart"}):n.createElement(ce,{accession:e,category:v,chartType:String(i.type)})))};var pe=a(2531),he=a(9980);const be=({selectedName:e=null,onTotalChange:t=S.Z,onMatchesChange:a=S.Z})=>{const{overviewData:r}=(0,n.useContext)(m),{matches:i,total:c,loading:u,error:d,processed:g}=((e,t=1/0)=>{const[a,r]=(0,n.useState)(1),[o,s]=(0,n.useState)([]),[i,c]=(0,n.useState)(0),[u,m]=(0,n.useState)(null),{data:d,isStale:g,loading:p,error:h}=(0,l.Z)(`analyses/${e}/interpro-identifiers`,{page:a});return(0,n.useEffect)((()=>{var e,n,l,p,h;if((null==d?void 0:d.data)&&!g&&a===(null===(n=null===(e=null==d?void 0:d.meta)||void 0===e?void 0:e.pagination)||void 0===n?void 0:n.page)){const e=o.length?o.slice(-1):[{name:"Others",matches:0}],n=o.length?[]:d.data.slice(0,10).map((({attributes:e})=>({accession:e.accession,name:e.description,matches:e.count})));e[0].matches+=d.data.slice(o.length?0:10).reduce(((e,{attributes:t})=>e+Number(t.count)),0);const g=[...o.slice(0,-1),...n,...e];s(g),c(i+d.data.length);const b=null===(p=null===(l=null==d?void 0:d.meta)||void 0===l?void 0:l.pagination)||void 0===p?void 0:p.count;u!==b&&"number"==typeof b&&m(b),(null===(h=null==d?void 0:d.links)||void 0===h?void 0:h.next)&&g.length<t&&r(a+1)}}),[d,a,t]),(0,n.useEffect)((()=>{var e;(null===(e=null==d?void 0:d.links)||void 0===e?void 0:e.next)&&o.length<t&&r(a+1)}),[t]),{matches:o,processed:i,total:u,loading:p,error:h}})(r.id),h=(0,n.useRef)(null),[v,f]=(0,n.useState)(0);if((0,n.useEffect)((()=>{if(i){const e=i.reduce(((e,{matches:t})=>e+t),0);f(e),t(e),a(i)}}),[i]),(0,n.useEffect)((()=>{if(h.current&&null!==e){let t=h.current.chart.series[0].data.findIndex((t=>t.name===e));h.current.chart.series[0].data.forEach((e=>e.setState(""))),-1===t&&e.length&&(t=h.current.chart.series[0].data.length-1),h.current.chart.series[0].data[t].setState("hover"),h.current.chart.tooltip.refresh(h.current.chart.series[0].data[t])}}),[e]),u&&!(null==i?void 0:i.length))return n.createElement(o.Z,null);if(d)return n.createElement(s.Z,{error:d});const y={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:"InterPro match summary"},subtitle:{text:`Total: ${v} InterPro matches`},tooltip:{pointFormat:"<b>{point.y}</b> {series.name} ({point.percentage:.2f}%)"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},colors:J.DC}},credits:{enabled:!1},series:[{name:"pCDS matched",colorByPoint:!0,data:i.map((({name:e,matches:t})=>({name:e,y:t})))}]};return n.createElement(n.Fragment,null,n.createElement(b(),{highcharts:p,options:y,ref:h}),g<c&&n.createElement("sup",null,"* With ",g," out of ",c," Interpro matches."))};function ve(e,t){let a=e.find((({key:e})=>e===t));return void 0!==a?a.value:(a=e.find((({key:e})=>e===`Contigs${t}`)),void 0!==a?a.value:e.find((({key:e})=>e===`Reads${t}`)))}const fe=()=>{const{overviewData:e}=(0,n.useContext)(m),t=(0,n.useRef)(null),a="assembly"===e.attributes["experiment-type"],l=e.attributes["analysis-summary"],r=[" with predicted CDS"," with predicted RNA"," with InterProScan match","Predicted CDS","Predicted CDS with InterProScan match"],o=[ve(l,r[0]),ve(l,r[1]),ve(l,r[2]),ve(l,r[3]),ve(l,r[4])].map(Number),s=a?"Contigs":"Reads";r[0]=s+r[0],r[1]=s+r[1],r[2]=s+r[2];const i={chart:{type:"bar",height:240},title:{text:"Sequence feature summary"},yAxis:{type:"logarithmic",title:{text:"Count (note the logarithmic scale)"}},xAxis:{categories:r},plotOptions:{series:{stacking:"normal"}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{pointFormat:"<b>{point.y}</b>"},series:[{data:o,color:"#058dc7"}]};return n.createElement(b(),{highcharts:p,options:i,ref:t})},ye=()=>{const{overviewData:e}=(0,n.useContext)(m),[t,a]=(0,n.useState)(-1),[r,i]=(0,n.useState)(new Map),[c,u]=(0,n.useState)(null),[d]=(0,B.B)({page:1,page_size:25,order:""},{page:Number,page_size:Number}),{data:g,loading:p,error:h,isStale:b}=(0,l.Z)(`analyses/${e.id}/interpro-identifiers`,{page:d.page,ordering:d.order,page_size:d.page_size}),v=[{id:"color",Header:"",accessor:"attributes.accession",Cell:({cell:e})=>n.createElement("div",{style:{width:"1rem",height:"1rem",display:"inline-block",backgroundColor:r.get(e.value)||J.DC.slice(-1)[0],verticalAlign:"sub"}}," ")},{id:"name",Header:"Entry name",accessor:"attributes.description"},{id:"accession",Header:"ID",accessor:"attributes.accession",Cell:({cell:e})=>n.createElement(pe.Z,{href:`http://www.ebi.ac.uk/interpro/entry/interpro/${e.value}`},e.value)},{Header:"pCDS matched",accessor:"attributes.count"},{id:"percentage",Header:"%",accessor:"attributes.count",Cell:({cell:e})=>-1===t?n.createElement(o.Z,{size:"small"}):(100*e.value/t).toFixed(2)}];return n.createElement("div",{className:"vf-stack"},n.createElement("div",null,n.createElement(fe,null)),n.createElement("h5",null,"InterPro match summary"),n.createElement("div",{className:"vf-grid mg-grid-30-70"},n.createElement("div",null,n.createElement(be,{selectedName:c,onTotalChange:e=>a(e),onMatchesChange:e=>{i(new Map(e.map((({accession:e},t)=>[e,J.DC[t]]))))}})),p&&!b&&n.createElement(o.Z,null),!p&&h&&n.createElement(s.Z,{error:h}),g&&!h&&n.createElement(Z.Z,{cols:v,data:g,initialPageSize:25,initialPage:d.page-1,className:"mg-anlyses-table",loading:p,isStale:b,onMouseEnterRow:e=>u(e.values.name),onMouseLeaveRow:()=>u(null),showPagination:!0})))},Ee=({categories:e,series:t,title:a,total:l,color:r})=>{const o=(0,n.useRef)(null),s={chart:{type:"bar",height:800,zoomType:"xy",renderTo:"container"},title:{text:a},subtitle:{text:`Total: ${l} annotations - Drag to zoom in/out`},yAxis:{min:0,title:{text:"Annotations"}},xAxis:{categories:e},plotOptions:{series:{stacking:"normal"},bar:{allowPointSelect:!0,cursor:"pointer",colors:J.DC}},credits:{enabled:!1},legend:{enabled:!1},tooltip:{pointFormat:"<b>{point.y}</b> {series.name}"},series:[{name:"annotations",data:t,color:r}]};return n.createElement(b(),{highcharts:p,options:s,ref:o})},_e=({categories:e,series:t,title:a,total:l})=>{const r=(0,n.useRef)(null),o=e.slice(0,10).map(((e,a)=>({name:e,y:t[a]}))),s={name:"Others",y:0};t.slice(10).forEach((e=>{s.y+=e})),o.push(s);const i={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,type:"pie"},title:{text:a},subtitle:{text:`Total: ${l} annotations`},tooltip:{pointFormat:"<b>{point.y}</b> {series.name} ({point.percentage:.2f}%)"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0,colors:J.DC}},credits:{enabled:!1},series:[{name:"annotations",colorByPoint:!0,data:o}],legend:{align:"right",verticalAlign:"middle",layout:"vertical",labelFormatter(){return this.name.length>15?`${this.name.slice(0,15)}...`:this.name}}};return n.createElement(b(),{highcharts:p,options:i,ref:r})},we=[{label:"Bar",to:"bar"},{label:"Pie",to:"pie"}],Ne=()=>{const{overviewData:e}=(0,n.useContext)(m),[t]=(0,B.B)({chart:""}),{data:a,loading:r,error:i}=(0,l.Z)(`analyses/${e.id}/go-slim`),[c,u]=(0,n.useState)(null);return(0,n.useEffect)((()=>{var e;if(null===(e=null==a?void 0:a.data)||void 0===e?void 0:e.length){const e={biological_process:{series:[],categories:[],total:0},molecular_function:{series:[],categories:[],total:0},cellular_component:{series:[],categories:[],total:0}};a.data.forEach((t=>{var a;const n=null===(a=null==t?void 0:t.attributes)||void 0===a?void 0:a.lineage;["biological_process","molecular_function","cellular_component"].includes(n)&&(e[n].categories.push(t.attributes.description),e[n].series.push(t.attributes.count),e[n].total+=t.attributes.count)})),u(e)}}),[a]),n.createElement("div",{className:"vf-stack"},n.createElement("h4",null,"GO terms annotation"),n.createElement("p",null,"A summary of Gene Ontology (GO) terms derived from InterPro matches to your sample is provided in the charts below."),r&&n.createElement(o.Z,null),i&&n.createElement(s.Z,{error:i}),a&&n.createElement(n.Fragment,null,n.createElement("h5",null,"Switch view:"),n.createElement(Y,{tabs:we,queryParameter:"chart",defaultValue:"bar"}),n.createElement("div",{className:"vf-tabs-content"},n.createElement("div",{className:"vf-grid vf-grid__col-3"},"bar"===t.chart&&c&&n.createElement(n.Fragment,null,n.createElement(Ee,{title:"Biological process",series:c.biological_process.series,categories:c.biological_process.categories,total:c.biological_process.total,color:J.DC[0]}),n.createElement(Ee,{title:"Molecular Function",series:c.molecular_function.series,categories:c.molecular_function.categories,total:c.molecular_function.total,color:J.DC[3]}),n.createElement(Ee,{title:"Cellular Component",series:c.cellular_component.series,categories:c.cellular_component.categories,total:c.cellular_component.total,color:J.DC[4]})),"pie"===t.chart&&c&&n.createElement(n.Fragment,null,n.createElement(_e,{title:"Biological process",series:c.biological_process.series,categories:c.biological_process.categories,total:c.biological_process.total}),n.createElement(_e,{title:"Molecular Function",series:c.molecular_function.series,categories:c.molecular_function.categories,total:c.molecular_function.total}),n.createElement(_e,{title:"Cellular Component",series:c.cellular_component.series,categories:c.cellular_component.categories,total:c.cellular_component.total}))))))},xe="type",Ce=[{label:"InterPro",to:"interpro"},{label:"GO Terms",to:"go"},{label:"Pfam",to:"pfam"},{label:"KO",to:"ko"}],ke=()=>{const{overviewData:e}=(0,n.useContext)(m),[t]=(0,B.B)({[xe]:""}),a=Number(e.attributes["pipeline-version"]),l="long_reads_assembly"===e.attributes["experiment-type"];return n.createElement("div",{className:"vf-stack"},n.createElement("p",null,"These charts present the functional analysis outputs of our pipeline, which focus on"," ",n.createElement(pe.Z,{href:"http://www.ebi.ac.uk/interpro",title:"InterPro website"},"InterPro"),a>=5&&n.createElement(n.Fragment,null,","," ",n.createElement(pe.Z,{href:"https://pfam.xfam.org/",title:"Pfam database webpage"},"Pfam"),","," ",n.createElement(pe.Z,{href:"https://www.genome.jp/kegg/ko.html",title:"KEGG orthologue (KO) webpage"},"KEGG orthologue"))," ","and"," ",n.createElement(pe.Z,{href:"https://www.uniprot.org/help/gene_ontology",title:"Gene Ontology webpage"},"GO")," ","term annotations. These summarise the functional content of the sequences in the sample. The full set of results files can be found under the ",n.createElement(u.rU,{to:"#download"},"Download")," tab."),l&&n.createElement(he.Z,{title:"Caution:",type:"info"},"The sequences in this sample are derived from long-read sequencing technology. Gene-prediction on this sequence data can be problematic, potentially resulting in fewer and/or truncated predictions."),n.createElement(Y,{tabs:a>=5?Ce:Ce.slice(0,2),queryParameter:xe,defaultValue:"interpro"}),n.createElement("div",{className:"vf-tabs-content"},"interpro"===t.type&&n.createElement(ye,null),"go"===t.type&&n.createElement(Ne,null)))};var Ze=a(1274);const Pe=e=>"assembly"===e.attributes["experiment-type"],Se=e=>Number(e.attributes["pipeline-version"])>=5,De=e=>"amplicon"!==e.attributes["experiment-type"],$e=()=>{var e,t,a,c,g,p;const h=(0,r.Z)(),{data:b,loading:v,error:f}=(0,l.Z)(`analyses/${h}`,{include:"downloads"}),y=(0,n.useMemo)((()=>({overviewData:null==b?void 0:b.data})),[b]);if(v)return n.createElement(o.Z,{size:"large"});if(f)return n.createElement(s.Z,{error:f});if(!b)return n.createElement(o.Z,null);const{data:E,included:_}=b,w=[{label:"Overview",to:"#overview"},{label:"Quality control",to:"#qc"},{label:"Taxonomic analysis",to:"#taxonomic"},De(E)?{label:"Functional analysis",to:"#functional"}:null,(x=_,x.some((e=>{var t;return"Statistics"===(null===(t=null==e?void 0:e.attributes)||void 0===t?void 0:t["group-type"])}))?{label:"Abundance and comparison",to:"#abundance"}:null),Pe(E)&&Se(E)?{label:"Pathways/Systems",to:"#path-systems"}:null,Pe(E)&&Se(E)?{label:"Contig Viewer",to:"#contigs-viewer"}:null,{label:"Download",to:"#download"}].filter(Boolean);var x;const C=Pe(E)?null===(a=null===(t=null===(e=null==E?void 0:E.relationships)||void 0===e?void 0:e.assembly)||void 0===t?void 0:t.data)||void 0===a?void 0:a.id:null===(p=null===(g=null===(c=null==E?void 0:E.relationships)||void 0===c?void 0:c.run)||void 0===g?void 0:g.data)||void 0===p?void 0:p.id;return n.createElement("section",{className:"vf-content"},n.createElement("h2",null,"Analysis ",h),C&&n.createElement("h4",null,n.createElement(u.rU,{to:C},"Other Analyses")),n.createElement(i.Z,{tabs:w}),n.createElement("section",{className:"vf-grid"},n.createElement("div",{className:"vf-stack vf-stack--200"},n.createElement(m.Provider,{value:y},n.createElement(Ze.Z,{hash:"#overview",isDefault:!0},n.createElement(d,null)),n.createElement(Ze.Z,{hash:"#qc"},n.createElement(N,null)),n.createElement(Ze.Z,{hash:"#contigs-viewer"},n.createElement(X,null)),n.createElement(Ze.Z,{hash:"#taxonomic"},n.createElement(ge,{accession:h})),n.createElement(Ze.Z,{hash:"#functional"},n.createElement(ke,null))))))}}}]);
//# sourceMappingURL=807.85b468bf.chunk.js.map