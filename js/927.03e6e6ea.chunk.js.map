{"version":3,"file":"js/927.03e6e6ea.chunk.js","mappings":"gRAeA,IAAc,GAEd,MAqHA,EAnH4E,EAC1EA,kBAAAA,GAAoB,MAEpB,MAAMC,GAAoB,IAAAC,QAAkC,MACtDC,GAAY,UAEXC,IAAe,OAAmB,eAAgB,EAAGC,SACrDC,IAAmB,OACxB,oBAVoB,GAYpBD,SAEKE,IAAgB,OAAmB,gBAAiB,KAErD,QAAEC,EAAO,QAAEC,IAAY,UACvB,KAAEC,EAAI,QAAEC,EAAO,QAAEC,EAAO,MAAEC,IAAU,OACxC,WAAWV,gBACX,CACEW,KAAMV,EACNW,SAAUR,EACVS,UAAWV,IAIf,GAAIK,EAAS,OAAO,gBAAC,IAAO,CAACM,KAAK,UAClC,GAAIJ,EAAO,OAAO,gBAAC,IAAU,CAACA,MAAOA,IACrC,IAAKH,EAAM,OAAO,gBAAC,IAAO,MAC1B,IAAIQ,EAAQ,EACZ,MAAMC,EAAcT,EAAKA,KAAuBU,KAAKC,GACnDC,OAAOD,EAAEE,WAAWC,QAEhBC,EAA0Bf,EAAKA,KAAuBgB,QAC1D,CAACC,EAAMN,KAELM,EAAKN,EAAEE,WAAWC,MAAkBH,EAAEE,WAAWK,YAC1CD,IAET,IAEIE,EAAgBnB,EAAKA,KAAuBU,KAAKC,IACrD,MAAMS,EAAIzB,OAAOgB,EAAEE,WAAW,iBAE9B,OADAL,GAASY,EACFA,KAEHC,EAAmBrB,EAAKA,KAAuBU,KAAKC,GACjDA,EAAEE,WAAW,qBA8CtB,OA3CAf,EAAQ,GAAGwB,OAAS,YAEpBvB,EAAQwB,MAAQ,CACdC,KAAM,iCAERzB,EAAQ0B,SAAW,CACjBD,KAAM,UAAUhB,+CAElBT,EAAQ2B,MAAQ,CACdjB,WAAAA,GAEFV,EAAQ4B,QAAU,CAEhBC,YACE,MAAMV,EAAcH,EAAuBc,KAAKC,KAChD,IAAIH,EAAU,GAAGE,KAAKE,OAAOjB,mBAAmBe,KAAKG,IAIrD,OAHId,IACFS,GAAW,sBAAsBT,KAE5BS,IAIX5B,EAAQgC,OAAS,CACf,CACEjB,KAAM,SACNmB,KAAM,SACNjC,KAAMmB,EAAae,MAAM,EAAG,IAC5BC,OAAQ,KACRC,MAAO,WAIP9C,GACFS,EAAQgC,OAAOM,KAAK,CAClBvB,KAAM,aACNmB,KAAM,SACNjC,KAAMqB,EAAgBa,MAAM,EAAG,IAC/BC,OAAQ,KACRC,MAAO,cAKT,uBACEE,UAAU,yBAAwB,UAC1B,+BAER,gBAAC,IAAe,CACdC,WAAY,EACZxC,QAASA,EACTyC,IAAKjD,IAEP,gBAAC,IAAQ,CACPkD,KAAM3C,EACNE,KAAMA,EACN0C,MAAO,OAAO1C,EAAK2C,KAAKC,WAAWC,qBACnC5C,QAASA,EACT6C,YAAcpD,EAAyB,EACvCqD,gBA7GgB,GA8GhBC,UAAU,WACV9C,QAASA,O,wDCnHjB,MAiFA,EAjF+B,KA8EtB,CAAEJ,SA7EO,IAAAmD,UACd,IAAM,CACJ,CACE3B,OAAQ,SACR4B,SAAU,mBAEZ,CACE5B,OAAQ,cACR4B,SAAU,0BAEZ,CACE5B,OAAQ,eACR4B,SAAU,2BAEZ,CACE5B,OAAQ,mBACR4B,SAAU,gCAGd,IA0DgBnD,QAvDkB,CAClCoD,MAAO,CACLlB,KAAM,SACNmB,OAAQ,IACRC,SAAU,KACVC,SAAU,aAKZC,MAAO,CACLC,IAAK,EACLjC,MAAO,CACLC,KAAM,sBAMViC,YAAa,CACX1B,OAAQ,CACN2B,SAAU,UAEZC,OAAQ,CACNC,kBAAkB,EAClBC,OAAQ,UACR1B,OAAQ,OAGZ2B,QAAS,CACPC,SAAS,GAEXC,OAAQ,CACND,SAAS","sources":["webpack://mgportalv2/./src/components/Genomes/KEGGModulesAnalysis/index.tsx","webpack://mgportalv2/./src/hooks/genomes/useDefaultConfig/index.tsx"],"sourcesContent":["import React, { useRef } from 'react';\nimport * as Highcharts from 'highcharts';\nimport addExportMenu from 'highcharts/modules/exporting';\nimport HighchartsReact from 'highcharts-react-official';\n\nimport Loading from 'components/UI/Loading';\nimport FetchError from 'components/UI/FetchError';\nimport EMGTable from 'components/UI/EMGTable';\nimport useMGnifyData from 'hooks/data/useMGnifyData';\nimport { MGnifyDatum, MGnifyResponseList } from 'hooks/data/useData';\nimport useURLAccession from 'hooks/useURLAccession';\nimport useDefaultGenomeConfig from 'hooks/genomes/useDefaultConfig';\nimport { TAXONOMY_COLOURS } from 'utils/taxon';\nimport useQueryParamState from 'hooks/queryParamState/useQueryParamState';\n\naddExportMenu(Highcharts);\n\nconst initialPageSize = 10;\n\nconst KEGGClassModulesAnalises: React.FC<{ includePangenomes?: boolean }> = ({\n  includePangenomes = true,\n}) => {\n  const chartComponentRef = useRef<HighchartsReact.RefObject>(null);\n  const accession = useURLAccession();\n\n  const [keggmodPage] = useQueryParamState('keggmod-page', 1, Number);\n  const [keggmodPageSize] = useQueryParamState(\n    'keggmod-page_size',\n    initialPageSize,\n    Number\n  );\n  const [keggmodOrder] = useQueryParamState('keggmod-order', '');\n\n  const { columns, options } = useDefaultGenomeConfig();\n  const { data, loading, isStale, error } = useMGnifyData(\n    `genomes/${accession}/kegg-module`,\n    {\n      page: keggmodPage,\n      ordering: keggmodOrder,\n      page_size: keggmodPageSize,\n    }\n  );\n\n  if (loading) return <Loading size=\"large\" />;\n  if (error) return <FetchError error={error} />;\n  if (!data) return <Loading />;\n  let total = 0;\n  const categories = (data.data as MGnifyDatum[]).map((d) =>\n    String(d.attributes.name)\n  );\n  const categoriesDescriptions = (data.data as MGnifyDatum[]).reduce(\n    (memo, d) => {\n      // eslint-disable-next-line no-param-reassign\n      memo[d.attributes.name as string] = d.attributes.description;\n      return memo;\n    },\n    {}\n  );\n  const genomeSeries = (data.data as MGnifyDatum[]).map((d) => {\n    const c = Number(d.attributes['genome-count']);\n    total += c;\n    return c;\n  });\n  const pangenomeSeries = (data.data as MGnifyDatum[]).map((d) => {\n    return d.attributes['pangenome-count'];\n  });\n\n  columns[0].Header = 'Module ID';\n\n  options.title = {\n    text: 'Top 10 KEGG module categories',\n  };\n  options.subtitle = {\n    text: `Total: ${total} KEGG module matches - Drag to zoom in/out`,\n  };\n  options.xAxis = {\n    categories,\n  };\n  options.tooltip = {\n    /* eslint-disable react/no-this-in-sfc */\n    formatter() {\n      const description = categoriesDescriptions[this.key];\n      let tooltip = `${this.series.name}<br/>Count: ${this.y}`;\n      if (description) {\n        tooltip += `<br />KEGG Module: ${description}`;\n      }\n      return tooltip;\n    },\n    /* eslint-enable react/no-this-in-sfc */\n  };\n  options.series = [\n    {\n      name: 'Genome',\n      type: 'column',\n      data: genomeSeries.slice(0, 10),\n      colors: TAXONOMY_COLOURS,\n      stack: 'genome',\n    },\n  ];\n\n  if (includePangenomes) {\n    options.series.push({\n      name: 'Pan-genome',\n      type: 'column',\n      data: pangenomeSeries.slice(0, 10),\n      colors: TAXONOMY_COLOURS,\n      stack: 'pangenome',\n    });\n  }\n\n  return (\n    <div\n      className=\"vf-stack vf-stack--200\"\n      data-cy=\"genome-kegg-module-analysis\"\n    >\n      <HighchartsReact\n        highcharts={Highcharts}\n        options={options}\n        ref={chartComponentRef}\n      />\n      <EMGTable\n        cols={columns}\n        data={data as MGnifyResponseList}\n        Title={`All ${data.meta.pagination.count} KEGG modules`}\n        loading={loading}\n        initialPage={(keggmodPage as number) - 1}\n        initialPageSize={initialPageSize}\n        namespace=\"keggmod-\"\n        isStale={isStale}\n      />\n    </div>\n  );\n};\n\nexport default KEGGClassModulesAnalises;\n","import { useMemo } from 'react';\nimport * as Highcharts from 'highcharts';\n\nimport { TAXONOMY_COLOURS } from 'utils/taxon';\n\ntype DefaultConfigType = {\n  columns: {\n    Header: string;\n    accessor: string;\n  }[];\n  options: Highcharts.Options;\n};\n\nconst useGenomeDefaultConfig = (): DefaultConfigType => {\n  const columns = useMemo(\n    () => [\n      {\n        Header: 'COG ID',\n        accessor: 'attributes.name',\n      },\n      {\n        Header: 'Description',\n        accessor: 'attributes.description',\n      },\n      {\n        Header: 'Genome Count',\n        accessor: 'attributes.genome-count',\n      },\n      {\n        Header: 'Pan-genome count',\n        accessor: 'attributes.pangenome-count',\n      },\n    ],\n    []\n  );\n\n  const options: Highcharts.Options = {\n    chart: {\n      type: 'column',\n      height: 400,\n      zoomType: 'xy',\n      renderTo: 'container',\n    },\n    // subtitle: {\n    //   text: `Total: ${total} Genome COG matches - Drag to zoom in/out`,\n    // },\n    yAxis: {\n      min: 0,\n      title: {\n        text: 'Number of matches',\n      },\n    },\n    // xAxis: {\n    //   categories,\n    // },\n    plotOptions: {\n      series: {\n        stacking: 'normal',\n      },\n      column: {\n        allowPointSelect: true,\n        cursor: 'pointer',\n        colors: TAXONOMY_COLOURS,\n      },\n    },\n    credits: {\n      enabled: false,\n    },\n    legend: {\n      enabled: true,\n    },\n    // tooltip: {\n    //   formatter() {\n    //     const description = categoriesDescriptions[this.key];\n    //     let tooltip = this.series.name + '<br/>Count: ' + this.y;\n    //     if (description) {\n    //       tooltip += '<br />COG: ' + description;\n    //     }\n    //     return tooltip;\n    //   },\n    // },\n    // series: [\n    //   {\n    //     name: 'Genome',\n    //     type: 'column',\n    //     data: genomeSeries.slice(0, 10),\n    //     colors: TAXONOMY_COLOURS,\n    //     stack: 'genome',\n    //   },\n    // ],\n  };\n  return { columns, options };\n};\n\nexport default useGenomeDefaultConfig;\n"],"names":["includePangenomes","chartComponentRef","useRef","accession","keggmodPage","Number","keggmodPageSize","keggmodOrder","columns","options","data","loading","isStale","error","page","ordering","page_size","size","total","categories","map","d","String","attributes","name","categoriesDescriptions","reduce","memo","description","genomeSeries","c","pangenomeSeries","Header","title","text","subtitle","xAxis","tooltip","formatter","this","key","series","y","type","slice","colors","stack","push","className","highcharts","ref","cols","Title","meta","pagination","count","initialPage","initialPageSize","namespace","useMemo","accessor","chart","height","zoomType","renderTo","yAxis","min","plotOptions","stacking","column","allowPointSelect","cursor","credits","enabled","legend"],"sourceRoot":""}